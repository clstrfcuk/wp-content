!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.CS_core=e()}}(function(){var e;return function t(e,i,n){function r(s,a){if(!i[s]){if(!e[s]){var h="function"==typeof require&&require;if(!a&&h)return h(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=i[s]={exports:{}};e[s][0].call(l.exports,function(t){var i=e[s][1][t];return r(i?i:t)},l,l.exports,t,e,i,n)}return i[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(e,t,i){var n={components:{},loadedComponentGroups:[],RegisteredComponents:{},_initChannel:function(){this.channelName="cs",this.channel=Backbone.Radio.channel(this.channelName)},initialize:function(){this.events=Backbone.Radio.channel("cs:event"),"true"==this.Config.debug&&(Backbone.Radio.DEBUG=!0),this.bootTime=(new Date).getTime(),this.registerComponents(e("./components"))},onBeforeStart:function(e){this.loadComponents("common")},onStart:function(){jQuery(_.bind(function(){this.loadComponents("start")},this))},loadComponents:function(e){this.Registry[e]&&_.each(this.Registry[e],function(e){this.loadComponent(e)},this)},loadComponent:function(e){return this.components[e]?this.components[e]:void(this.components[e]=new this.RegisteredComponents[e]({cs:this}))},component:function(e){return this.components[e]?this.components[e]:{}},registerComponents:function(e){this.RegisteredComponents=_.extend(e,this.RegisteredComponents)},updateConfig:function(e){this.Config=_.deepExtend(e,this.Config)},updateRegistry:function(e){_.each(e,function(e,t){var i=this.Registry[t]||[];this.Registry[t]=_.unique(_.union(i,e))},this)},config:function(e){return this.Config[e]?this.Config[e]:null},debug:function(){return"true"==this.config("debug")}};_.extend(n,e("./modules/cs")),n=Cornerstone.Mn.Application.extend(n),t.exports=function(e,t){(window.cs=new n({Config:e,Registry:t})).start({})}},{"./components":11,"./modules/cs":24}],2:[function(e,t,i){t.exports=Backbone.Collection.extend({model:e("../models/control")})},{"../models/control":14}],3:[function(e,t,i){t.exports=Backbone.Collection.extend({model:e("../models/element-definition")})},{"../models/element-definition":15}],4:[function(e,t,i){var n=e("./proxyable");t.exports=n.extend({model:e("../models/element"),comparator:function(e){return e.get("rank")},constructor:function(e,t){this.on("update:position",this.updatePosition),Backbone.Collection.apply(this,arguments),this.on("add",this.pageDirty),this.on("remove",this.pageDirty),this.on("sort",this.pageDirty)},create:function(e,t,i){e._type||cs.warn("Elements can not be created without a type",e);var n=new this.model(e,t);return this.updatePosition(n,_.isFinite(i)?i:this.length),n},pageDirty:function(){cs.channel.trigger("page:unsaved")},updatePosition:function(e,t){this.remove(e),this.each(function(e,i){var n=i;i>=t&&(n+=1),e.set("rank",n)}),e.set("rank",t),this.add(e,{at:t}),this.sort(),this.each(function(e){e.trigger("position:updated")})}})},{"../models/element":16,"./proxyable":6}],5:[function(e,t,i){t.exports={Proxyable:e("./proxyable"),Element:e("./element"),ElementDefinition:e("./element-definition"),Control:e("./control"),Template:e("./template"),Setting:e("./setting")}},{"./control":2,"./element":4,"./element-definition":3,"./proxyable":6,"./setting":7,"./template":8}],6:[function(e,t,i){var n=Backbone.Collection.extend({model:e("../models/proxyable"),toProxy:function(){var e=new Backbone.Collection;return this.each(function(t){var i=t.getDefaults();e.add(new t.proxyClass(_.extend(i,t.proxyData()),{source:t,defaults:i}))}),e}});n.prototype.sync=function(){return null},n.prototype.fetch=function(){return null},n.prototype.save=function(){return null},t.exports=n},{"../models/proxyable":18}],7:[function(e,t,i){var n=e("./proxyable");t.exports=n.extend({model:e("../models/setting")})},{"../models/setting":19,"./proxyable":6}],8:[function(e,t,i){var n=Backbone.Collection.extend({model:e("../models/template"),section:function(e){return bySection=this.filter(function(t){return t.get("section")===e}),new n(bySection)}});t.exports=n},{"../models/template":20}],9:[function(e,t,i){t.exports=Cornerstone.Component.extend({initialize:function(){cs.elements=Backbone.Radio.channel("cs:elements"),this.listenTo(cs.elements,"delete",this.deleteEl),this.listenTo(cs.elements,"erase",this.erase),this.listenTo(cs.elements,"reset",this.resetEl),this.listenTo(cs.elements,"add:item",this.add),this.listenTo(cs.elements,"duplicate",this.duplicate)},deleteEl:function(e){e.model&&e.model.destroy({success:function(){cs.events.trigger("inspect:clear"),e.success&&_.defer(e.success)}})},resetEl:function(e){if(e.model){e.model.get("_type");e.model.collection.create({type:"_type"},{},e.model.collection.indexOf(e.model)+1),e.model.destroy()}},erase:function(e){e.model&&(_.isEmpty(e.model.elements)||e.model.elements.reset(),e.success&&_.defer(e.success))},add:function(e,t,i,n){if(e&&t.elements){var r={_type:e};if(i){var n=n||"title";r[n]=i.replace("%s",t.elements.length+1)}t.elements.create(r)}},duplicate:function(e,t){e.updateChildData();var i=e.toJSON(),t=t||"title";i[t]&&(i[t]=cs.l18n("sortable-duplicate").replace("%s",i[t]));var n=e.collection.create(i,_.clone(e.options),e.collection.indexOf(e)+1);n.shadow=e.cid}})},{}],10:[function(e,t,i){t.exports=Cornerstone.Component.extend({initialize:function(){this.library=new Cornerstone.Collections.ElementDefinition;var e=this.cs.config("elementDefinitions");_.isArray(e)&&this.library.add(e),this.cs.elementLibrary=this},lookup:function(e){var t=this.library.findWhere({name:e});return t?t:this.library.findWhere({name:"undefined"})},all:function(){return new Cornerstone.Collections.ElementDefinition(this.library.models)}})},{}],11:[function(e,t,i){t.exports={"element-library":e("./element-library"),"element-handler":e("./element-handler")}},{"./element-handler":9,"./element-library":10}],12:[function(e,t,i){e("./modules/bootstrap"),e("./app-mk2")(csCoreData,{common:["element-library","element-handler"]})},{"./app-mk2":1,"./modules/bootstrap":22}],13:[function(e,t,i){t.exports=Backbone.Model.extend({initialize:function(e,t){this.source=t.source||null;t.defaults||null;this.source&&(this.elements=t.source.elements||null,this.definition=t.source.definition||null),this.listenTo(this.source,"children:updated",function(){this.trigger("children:updated")}),this.listenTo(this.source,"position:updated",function(){this.trigger("position:updated")})},getIndex:function(){return this.source.getIndex()},getSource:function(){return this.source},getSourceParent:function(){return this.source.collection.parent},getSourceGrandParent:function(){return this.source.collection.parent.collection.parent},refresh:function(){this.set(_.clone(this.source.attributes),{silent:!0})}})},{}],14:[function(e,t,i){t.exports=Backbone.Model.extend({defaults:{name:null,key:null,type:null,ui:{},options:{},context:"all",condition:{}},initialize:function(){this.proxy=null,_.isNull(this.get("key"))&&this.set("key",this.get("name"))},setProxy:function(e){this.proxy=e,this.trigger("set:proxy")}})},{}],15:[function(e,t,i){t.exports=Backbone.Model.extend({defaults:{name:null,ui:null,flags:null,active:!0,base_defaults:{},defaults:{},controls:[]},getDefaults:function(e){return this.get(e?e+"_defaults":"defaults")},getControls:function(e){var e=e||"all";return _.filter(this.get("controls"),function(t){return"all"==e&&0!==t.context.indexOf("_")?!0:t.context==e},this)}})},{}],16:[function(e,t,i){var n=e("./proxyable");t.exports=n.extend({idAttribute:"_elID",proxyClass:e("./control-proxy"),proxyExclusions:["elements"],defaults:{_type:"undefined"},initialize:function(e){var t,i,n,r;this.definition=this.getDefinition(),(r=this.definition.get("_layout_defaults"))&&_.each(r,function(e,t){this.has(t)||this.set(t,e)},this),this.elements=new Cornerstone.Collections.Element,this.elements.parent=this,t=this.get("elements"),i=this.definition.get("defaults"),n=_.isUndefined(t)?i.elements?i.elements:[]:t,n&&!_.isEmpty(n)&&this.elements.add(n),this.listenTo(this.elements,"update",function(){this.trigger("children:updated")}),this.on("change",function(e,t){this.collection&&this.collection.trigger("model:change",e,t)}),this.on("update:child:data",this.updateChildData)},getDefaults:function(){return _.clone(this.definition.getDefaults())},updateChildData:function(){return this.elements.isEmpty()?void this.set("elements",[]):(this.elements.invoke("updateChildData"),void this.set("elements",this.elements.toJSON()))},getDefinition:function(){return cs.elementLibrary.lookup(this.get("_type"))},eraseChildren:function(){this.elements.isEmpty()||(this.elements.invoke("destroy"),this.updateChildData())},getIndex:function(){return this.collection.indexOf(this)},toJSON:function(){return _.omit(Backbone.Model.prototype.toJSON.apply(this,arguments),["rank"])}})},{"./control-proxy":13,"./proxyable":18}],17:[function(e,t,i){var n={Element:e("./element"),ElementDefinition:e("./element-definition"),Control:e("./control"),Setting:e("./setting"),Proxyable:e("./proxyable"),Template:e("./template"),ControlProxy:e("./control-proxy")};t.exports=n},{"./control":14,"./control-proxy":13,"./element":16,"./element-definition":15,"./proxyable":18,"./setting":19,"./template":20}],18:[function(e,t,i){var n=Backbone.Model.extend({proxyClass:Backbone.Model,proxyExclusions:[],proxyData:function(){return _.omit(this.attributes,this.proxyExclusions)},toProxy:function(){var e=this.getDefaults();return new this.proxyClass(_.extend(e,this.proxyData()),{source:this,defaults:e})},proxyUpdate:function(e){var t=this.getDefaults();_.each(e,function(e,i){"disabled"!=i&&(_.isEqual(t[i],e)?this.unset(i):this.set(i,e))},this)},getDefaults:function(){return{}}});n.prototype.sync=function(){return null},n.prototype.fetch=function(){return null},n.prototype.save=function(){return null},t.exports=n},{}],19:[function(e,t,i){var n=e("./proxyable");t.exports=n.extend({idAttribute:"_sID",proxyClass:e("./control-proxy"),proxyExclusions:["elements"],defaults:{_section:"undefined"},initialize:function(e){var t,i,n;this.section=this.getSection(),this.elements=new Cornerstone.Collections.Element,this.elements.parent=this,t=this.get("elements"),i=this.section.get("defaults"),n=_.isEmpty(t)?i.elements?i.elements:[]:t,n&&!_.isEmpty(n)&&this.elements.add(n),this.listenTo(this.elements,"update",function(){this.trigger("children:updated")}),this.on("change",function(e,t){this.collection&&this.collection.trigger("model:change",e,t)}),this.on("update:child:data",this.updateChildData)},getDefaults:function(){return _.clone(this.section.get("defaults"))},updateChildData:function(){return this.elements.isEmpty()?void this.set("elements",[]):(this.elements.invoke("updateChildData"),void this.set("elements",this.elements.toJSON()))},getSection:function(){return cs.settingSections.findWhere({name:this.get("_section")})},eraseChildren:function(){this.elements.isEmpty()||(this.elements.invoke("destroy"),this.updateChildData())},getIndex:function(){return this.collection.indexOf(this)},toJSON:function(){return _.omit(Backbone.Model.prototype.toJSON.apply(this,arguments),["rank"])}})},{"./control-proxy":13,"./proxyable":18}],20:[function(e,t,i){t.exports=Backbone.Model.extend({defaults:{title:"Generic Block",section:"user-blocks",type:"block",elements:[]}})},{}],21:[function(e,t,i){t.exports=function(e,t,i){var n=cs.fallbackAjax?"fallbackAjaxUrl":"ajaxUrl",r=_.defaults(i||{},{type:"POST",url:cs.config(n)+"?action="+e,context:this,data:JSON.stringify(t||{}),dataType:"json"});return Backbone.$.Deferred(function(e){r.always&&e.always(r.always),r.success&&e.done(r.success),r.error&&e.fail(r.error),delete r.always,delete r.success,delete r.error,Backbone.$.ajax(r).done(function(t){"true"!=arguments[2].getResponseHeader("Cornerstone")&&cs.global.trigger("ajax:fallback",!0),_.isObject(t)&&!_.isUndefined(t.success)?e[t.success?"resolveWith":"rejectWith"](this,[t.data,r]):e.rejectWith(this,[t])}).fail(function(t){cs.global.trigger("ajax:fallback",!0),e.rejectWith(this,arguments)})}).promise()}},{}],22:[function(e,t,i){window.Cornerstone=window.CS={};var n=e("./../../vendor/underscore-shim.js");e("../../vendor/string_score"),e("backbone.radio"),e("backbone.stickit"),n.mixin({deepExtend:e("underscore-deep-extend")(n)}),Cornerstone.Vendor={Marionette:e("backbone.marionette"),FileSaver:e("../../vendor/FileSaver"),Color:e("../../vendor/color")},Cornerstone.Mn=Cornerstone.Vendor.Marionette,Cornerstone.Component=e("./component-base"),Cornerstone.Models=e("../models"),Cornerstone.Collections=e("../collections"),Cornerstone.InspectionSupervisor=e("./inspection-supervisor"),Cornerstone.Post=e("./post"),Cornerstone.serial=e("./serial"),t.exports=Cornerstone},{"../../vendor/FileSaver":28,"../../vendor/color":30,"../../vendor/string_score":32,"../collections":5,"../models":17,"./../../vendor/underscore-shim.js":33,"./component-base":23,"./inspection-supervisor":25,"./post":26,"./serial":27,"backbone.marionette":35,"backbone.radio":36,"backbone.stickit":37,"underscore-deep-extend":39}],23:[function(e,t,i){t.exports=Cornerstone.Mn.Object.extend({constructor:function(e){this.options=e||{},this.cs=this.getOption("cs"),Cornerstone.Mn.Object.call(this,e)}})},{}],24:[function(e,t,i){t.exports={ajax:e("./ajax"),template:function(){return this.Templates[1==arguments.length?arguments[0]:arguments.join("/")]},icon:function(){var e=1==arguments.length?arguments[0]:arguments.join("/");return this.Icons[e]?this.Icons[e]():0==e.indexOf("element-")?this.Icons["element-custom"]():'<i class="cs-icon fallback" data-cs-icon="'+this.fontIcon()+'"><!-- icon '+e+" not found--></i>"},fontIcon:function(){return String.fromCharCode("0x"+this.fontIconLookup(arguments[0]||void 0))},fontIconLookup:function(){var e="spinner",t=arguments[0]||e;return this.Config.fontAwesome[t]?this.Config.fontAwesome[t]:this.Config.fontAwesome[e]},l18n:function(e){return this.Config.strings[e]||""},log:function(){"true"==this.Config.debug&&console.log.apply(console,arguments)},warn:function(){"true"==this.Config.debug&&(console.warn.apply(console,arguments),console.trace())},controlLookup:function(e){return Cornerstone.ControlViews[e]||Cornerstone.ControlViews.Base}}},{"./ajax":21}],25:[function(e,t,i){t.exports=Cornerstone.Mn.Object.extend({initialize:function(e){this.controls=new Cornerstone.Collections.Control,this.reset(),e&&(e.length?_.each(e,function(e){this.source(e)},this):this.source(e),this.rebuildControls())},source:function(e){if(e&&e.name&&e.source&&e.controls){this.groups[e.name]||(this.groups[e.name]={controls:new Cornerstone.Collections.Control});var t=this.groups[e.name];t.source=e.source,t.proxy=e.source.toProxy(),t.controls.reset(),this.groups[e.name]=t,this.listenTo(t.proxy,"change",function(e,i){t.source.proxyUpdate(e.changed)}),this.listenTo(t.proxy,"reset:key",function(e){t.source.unset(e)}),this.listenTo(t.controls,"add",function(e,i){e.setProxy(t.proxy)}),this.listenTo(t.controls,"reset",function(e){e.invoke("setProxy",t.proxy)}),t.controls.add(e.controls)}},reset:function(){this.groups={},this.controls.reset()},rebuildControls:function(){this.controls.reset(),_.each(this.groups,function(e){this.controls.add(e.controls.models)},this)}})},{}],26:[function(e,t,i){t.exports=Cornerstone.Mn.Object.extend({initialize:function(e){this.data=new Cornerstone.Models.Element,e&&e.post_id&&(this.data.set("post_id",e.post_id),e.elements&&this.data.elements.add(e.elements))},elements:function(){return this.data.elements},set:function(e,t){return this[e]?this[e]=t:this.data.set(e,t)},get:function(e){return this[e]?this[e]:this.data.get(e)},toJSON:function(){this.data.elements.invoke("updateChildData");var e=this.data.toJSON();return e.elements=this.data.elements.toJSON(),e}})},{}],27:[function(e,t,i){t.exports=function(t){var i,n=e("./../../vendor/jquery-shim.js");return _.each(t,function(e){var t=function(){var t=n.Deferred();return e(function(){t.resolve.apply(this,arguments)}),t.promise()};i=i?i.then(t):t()}),i}},{"./../../vendor/jquery-shim.js":31}],28:[function(t,i,n){var r=r||function(e){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var t=e.document,i=function(){return e.URL||e.webkitURL||e},n=t.createElementNS("http://www.w3.org/1999/xhtml","a"),r="download"in n,o=function(e){var t=new MouseEvent("click");e.dispatchEvent(t)},s=e.webkitRequestFileSystem,a=e.requestFileSystem||s||e.mozRequestFileSystem,h=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},c="application/octet-stream",l=0,u=500,d=function(t){var n=function(){"string"==typeof t?i().revokeObjectURL(t):t.remove()};e.chrome?n():setTimeout(n,u)},f=function(e,t,i){t=[].concat(t);for(var n=t.length;n--;){var r=e["on"+t[n]];if("function"==typeof r)try{r.call(e,i||e)}catch(o){h(o)}}},g=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e},p=function(t,h,u){u||(t=g(t));var p,m,v,y=this,_=t.type,b=!1,w=function(){f(y,"writestart progress write writeend".split(" "))},C=function(){if((b||!p)&&(p=i().createObjectURL(t)),m)m.location.href=p;else{var n=e.open(p,"_blank");void 0==n&&"undefined"!=typeof safari&&(e.location.href=p)}y.readyState=y.DONE,w(),d(p)},x=function(e){return function(){return y.readyState!==y.DONE?e.apply(this,arguments):void 0}},M={create:!0,exclusive:!1};return y.readyState=y.INIT,h||(h="download"),r?(p=i().createObjectURL(t),n.href=p,n.download=h,void setTimeout(function(){o(n),w(),d(p),y.readyState=y.DONE})):(e.chrome&&_&&_!==c&&(v=t.slice||t.webkitSlice,t=v.call(t,0,t.size,c),b=!0),s&&"download"!==h&&(h+=".download"),(_===c||s)&&(m=e),a?(l+=t.size,void a(e.TEMPORARY,l,x(function(e){e.root.getDirectory("saved",M,x(function(e){var i=function(){e.getFile(h,M,x(function(e){e.createWriter(x(function(i){i.onwriteend=function(t){m.location.href=e.toURL(),y.readyState=y.DONE,f(y,"writeend",t),d(e)},i.onerror=function(){var e=i.error;e.code!==e.ABORT_ERR&&C()},"writestart progress write abort".split(" ").forEach(function(e){i["on"+e]=y["on"+e]}),i.write(t),y.abort=function(){i.abort(),y.readyState=y.DONE},y.readyState=y.WRITING}),C)}),C)};e.getFile(h,{create:!1},x(function(e){e.remove(),i()}),x(function(e){e.code===e.NOT_FOUND_ERR?i():C()}))}),C)}),C)):void C())},m=p.prototype,v=function(e,t,i){return new p(e,t,i)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,i){return i||(e=g(e)),navigator.msSaveOrOpenBlob(e,t||"download")}:(m.abort=function(){var e=this;e.readyState=e.DONE,f(e,"abort")},m.readyState=m.INIT=0,m.WRITING=1,m.DONE=2,m.error=m.onwritestart=m.onprogress=m.onwrite=m.onabort=m.onerror=m.onwriteend=null,v)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof i&&i.exports?i.exports.saveAs=r:"undefined"!=typeof e&&null!==e&&null!=e.amd&&e([],function(){return r})},{}],29:[function(e,t,i){window.CornerstoneShims=window.CornerstoneShims||{},window.CornerstoneShims.Backbone||(window.CornerstoneShims.Backbone=window.Backbone),t.exports=window.CornerstoneShims.Backbone},{}],30:[function(e,t,i){!function(e,n){var r=function(e,t){return this instanceof r?this._init(e,t):new r(e,t)};r.fn=r.prototype={_color:0,_alpha:1,error:!1,_hsl:{h:0,s:0,l:0},_hsv:{h:0,s:0,v:0},_hSpace:"hsl",_init:function(e){var t="noop";switch(typeof e){case"object":return e.a!==n&&this.a(e.a),t=e.r!==n?"fromRgb":e.l!==n?"fromHsl":e.v!==n?"fromHsv":t,this[t](e);case"string":return this.fromCSS(e);case"number":return this.fromInt(parseInt(e,10))}return this},_error:function(){return this.error=!0,this},clone:function(){for(var e=new r(this.toInt()),t=["_alpha","_hSpace","_hsl","_hsv","error"],i=t.length-1;i>=0;i--)e[t[i]]=this[t[i]];return e},setHSpace:function(e){return this._hSpace="hsv"===e?e:"hsl",this},noop:function(){return this},fromCSS:function(e){var t,i=/^(rgb|hs(l|v))a?\(/;if(this.error=!1,e=e.replace(/^\s+/,"").replace(/\s+$/,"").replace(/;$/,""),e.match(i)&&e.match(/\)$/)){if(t=e.replace(/(\s|%)/g,"").replace(i,"").replace(/,?\);?$/,"").split(","),t.length<3)return this._error();if(4===t.length&&(this.a(parseFloat(t.pop())),this.error))return this;for(var n=t.length-1;n>=0;n--)if(t[n]=parseInt(t[n],10),isNaN(t[n]))return this._error();return e.match(/^rgb/)?this.fromRgb({r:t[0],g:t[1],b:t[2]}):e.match(/^hsv/)?this.fromHsv({h:t[0],s:t[1],v:t[2]}):this.fromHsl({h:t[0],s:t[1],l:t[2]})}return this.fromHex(e)},fromRgb:function(e,t){return"object"!=typeof e||e.r===n||e.g===n||e.b===n?this._error():(this.error=!1,this.fromInt(parseInt((e.r<<16)+(e.g<<8)+e.b,10),t))},fromHex:function(e){return e=e.replace(/^#/,"").replace(/^0x/,""),3===e.length&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),this.error=!/^[0-9A-F]{6}$/i.test(e),this.fromInt(parseInt(e,16))},fromHsl:function(e){var t,i,r,o,s,a,h,c;return"object"!=typeof e||e.h===n||e.s===n||e.l===n?this._error():(this._hsl=e,this._hSpace="hsl",a=e.h/360,h=e.s/100,c=e.l/100,0===h?t=i=r=c:(o=.5>c?c*(1+h):c+h-c*h,s=2*c-o,t=this.hue2rgb(s,o,a+1/3),i=this.hue2rgb(s,o,a),r=this.hue2rgb(s,o,a-1/3)),this.fromRgb({r:255*t,g:255*i,b:255*r},!0))},fromHsv:function(e){var t,i,r,o,s,a,h,c,l,u,d;if("object"!=typeof e||e.h===n||e.s===n||e.v===n)return this._error();switch(this._hsv=e,this._hSpace="hsv",t=e.h/360,i=e.s/100,r=e.v/100,h=Math.floor(6*t),c=6*t-h,l=r*(1-i),u=r*(1-c*i),d=r*(1-(1-c)*i),h%6){case 0:o=r,s=d,a=l;break;case 1:o=u,s=r,a=l;break;case 2:o=l,s=r,a=d;break;case 3:o=l,s=u,a=r;break;case 4:o=d,s=l,a=r;break;case 5:o=r,s=l,a=u}return this.fromRgb({r:255*o,g:255*s,b:255*a},!0)},fromInt:function(e,t){return this._color=parseInt(e,10),isNaN(this._color)&&(this._color=0),this._color>16777215?this._color=16777215:this._color<0&&(this._color=0),t===n&&(this._hsv.h=this._hsv.s=this._hsl.h=this._hsl.s=0),this},hue2rgb:function(e,t,i){return 0>i&&(i+=1),i>1&&(i-=1),1/6>i?e+6*(t-e)*i:.5>i?t:2/3>i?e+(t-e)*(2/3-i)*6:e},toString:function(){var e=parseInt(this._color,10).toString(16);if(this.error)return"";if(e.length<6)for(var t=6-e.length-1;t>=0;t--)e="0"+e;return"#"+e},toCSS:function(e,t){switch(e=e||"hex",t=parseFloat(t||this._alpha),e){case"rgb":case"rgba":var i=this.toRgb();return 1>t?"rgba( "+i.r+", "+i.g+", "+i.b+", "+t+" )":"rgb( "+i.r+", "+i.g+", "+i.b+" )";case"hsl":case"hsla":var n=this.toHsl();return 1>t?"hsla( "+n.h+", "+n.s+"%, "+n.l+"%, "+t+" )":"hsl( "+n.h+", "+n.s+"%, "+n.l+"% )";default:return this.toString()}},toRgb:function(){return{r:255&this._color>>16,g:255&this._color>>8,b:255&this._color}},toHsl:function(){var e,t,i=this.toRgb(),n=i.r/255,r=i.g/255,o=i.b/255,s=Math.max(n,r,o),a=Math.min(n,r,o),h=(s+a)/2;if(s===a)e=t=0;else{var c=s-a;switch(t=h>.5?c/(2-s-a):c/(s+a),s){case n:e=(r-o)/c+(o>r?6:0);break;case r:e=(o-n)/c+2;break;case o:e=(n-r)/c+4}e/=6}return e=Math.round(360*e),0===e&&this._hsl.h!==e&&(e=this._hsl.h),t=Math.round(100*t),0===t&&this._hsl.s&&(t=this._hsl.s),{h:e,s:t,l:Math.round(100*h)}},toHsv:function(){var e,t,i=this.toRgb(),n=i.r/255,r=i.g/255,o=i.b/255,s=Math.max(n,r,o),a=Math.min(n,r,o),h=s,c=s-a;if(t=0===s?0:c/s,s===a)e=t=0;else{switch(s){case n:e=(r-o)/c+(o>r?6:0);break;case r:e=(o-n)/c+2;break;case o:e=(n-r)/c+4}e/=6}return e=Math.round(360*e),0===e&&this._hsv.h!==e&&(e=this._hsv.h),t=Math.round(100*t),0===t&&this._hsv.s&&(t=this._hsv.s),{h:e,s:t,v:Math.round(100*h)}},toInt:function(){return this._color},toIEOctoHex:function(){var e=this.toString(),t=parseInt(255*this._alpha,10).toString(16);return 1===t.length&&(t="0"+t),"#"+t+e.replace(/^#/,"")},toLuminosity:function(){var e=this.toRgb();return.2126*Math.pow(e.r/255,2.2)+.7152*Math.pow(e.g/255,2.2)+.0722*Math.pow(e.b/255,2.2)},getDistanceLuminosityFrom:function(e){if(!(e instanceof r))throw"getDistanceLuminosityFrom requires a Color object";var t=this.toLuminosity(),i=e.toLuminosity();return t>i?(t+.05)/(i+.05):(i+.05)/(t+.05)},getMaxContrastColor:function(){var e=this.toLuminosity(),t=e>=.5?"000000":"ffffff";return new r(t)},getReadableContrastingColor:function(e,t){if(!e instanceof r)return this;var i=t===n?5:t,o=e.getDistanceLuminosityFrom(this),s=e.getMaxContrastColor(),a=s.getDistanceLuminosityFrom(e);if(i>=a)return s;if(o>=i)return this;for(var h=0===s.toInt()?-1:1;i>o&&(this.l(h,!0),o=this.getDistanceLuminosityFrom(e),0!==this._color&&16777215!==this._color););return this},a:function(e){if(e===n)return this._alpha;var t=parseFloat(e);return isNaN(t)?this._error():(this._alpha=t,this)},darken:function(e){return e=e||5,this.l(-e,!0)},lighten:function(e){return e=e||5,this.l(e,!0)},saturate:function(e){return e=e||15,this.s(e,!0)},desaturate:function(e){return e=e||15,this.s(-e,!0)},toGrayscale:function(){return this.setHSpace("hsl").s(0)},getComplement:function(){return this.h(180,!0)},getSplitComplement:function(e){e=e||1;var t=180+30*e;return this.h(t,!0)},getAnalog:function(e){e=e||1;var t=30*e;return this.h(t,!0)},getTetrad:function(e){e=e||1;var t=60*e;return this.h(t,!0)},getTriad:function(e){e=e||1;var t=120*e;return this.h(t,!0)},_partial:function(e){var t=o[e];return function(i,r){var o=this._spaceFunc("to",t.space);return i===n?o[e]:(r===!0&&(i=o[e]+i),t.mod&&(i%=t.mod),t.range&&(i=i<t.range[0]?t.range[0]:i>t.range[1]?t.range[1]:i),o[e]=i,this._spaceFunc("from",t.space,o))}},_spaceFunc:function(e,t,i){var n=t||this._hSpace,r=e+n.charAt(0).toUpperCase()+n.substr(1);return this[r](i)}};var o={h:{mod:360},s:{range:[0,100]},l:{space:"hsl",range:[0,100]},v:{space:"hsv",range:[0,100]},r:{space:"rgb",range:[0,255]},g:{space:"rgb",range:[0,255]},b:{space:"rgb",range:[0,255]}};for(var s in o)o.hasOwnProperty(s)&&(r.fn[s]=r.fn._partial(s));"object"==typeof i?t.exports=r:e.Color=r}(this)},{}],31:[function(e,t,i){window.CornerstoneShims=window.CornerstoneShims||{},window.CornerstoneShims.$||(window.CornerstoneShims.$=window.jQuery),t.exports=window.CornerstoneShims.$},{}],32:[function(e,t,i){String.prototype.score=function(e,t){"use strict";if(this===e)return 1;if(""===e)return 0;var i,n,r,o,s,a=0,h=this,c=h.toLowerCase(),l=h.length,u=e.toLowerCase(),d=e.length,f=0,g=1;if(t&&(o=1-t),t)for(s=0;d>s;s+=1)r=c.indexOf(u[s],f),-1===r?g+=o:(f===r?i=.7:(i=.1," "===h[r-1]&&(i+=.8)),h[r]===e[s]&&(i+=.1),a+=i,f=r+1);else for(s=0;d>s;s+=1){if(r=c.indexOf(u[s],f),-1===r)return 0;f===r?i=.7:(i=.1," "===h[r-1]&&(i+=.8)),h[r]===e[s]&&(i+=.1),a+=i,f=r+1}return n=.5*(a/l+a/d)/g,u[0]===c[0]&&.85>n&&(n+=.15),n}},{}],33:[function(e,t,i){window.CornerstoneShims=window.CornerstoneShims||{},window.CornerstoneShims._||(window.CornerstoneShims._=window._),t.exports=window.CornerstoneShims._},{}],34:[function(t,i,n){!function(r,o){if("function"==typeof e&&e.amd)e(["backbone","underscore"],function(e,t){return o(e,t)});else if("undefined"!=typeof n){var s=t("./../../../assets/js/src/admin/vendor/backbone-shim.js"),a=t("./../../../assets/js/src/admin/vendor/underscore-shim.js");i.exports=o(s,a)}else o(r.Backbone,r._)}(this,function(e,t){"use strict";var i=e.ChildViewContainer;return e.ChildViewContainer=function(e,t){var i=function(e){this._views={},this._indexByModel={},this._indexByCustom={},this._updateLength(),t.each(e,this.add,this)};t.extend(i.prototype,{add:function(e,t){var i=e.cid;return this._views[i]=e,e.model&&(this._indexByModel[e.model.cid]=i),t&&(this._indexByCustom[t]=i),this._updateLength(),this},findByModel:function(e){return this.findByModelCid(e.cid)},findByModelCid:function(e){var t=this._indexByModel[e];return this.findByCid(t)},findByCustom:function(e){var t=this._indexByCustom[e];return this.findByCid(t)},findByIndex:function(e){return t.values(this._views)[e]},findByCid:function(e){return this._views[e]},remove:function(e){var i=e.cid;return e.model&&delete this._indexByModel[e.model.cid],t.any(this._indexByCustom,function(e,t){return e===i?(delete this._indexByCustom[t],!0):void 0},this),delete this._views[i],this._updateLength(),this},call:function(e){this.apply(e,t.tail(arguments))},apply:function(e,i){t.each(this._views,function(n){t.isFunction(n[e])&&n[e].apply(n,i||[])})},_updateLength:function(){this.length=t.size(this._views)}});var n=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck","reduce"];return t.each(n,function(e){i.prototype[e]=function(){var i=t.values(this._views),n=[i].concat(t.toArray(arguments));return t[e].apply(t,n)}}),i}(e,t),e.ChildViewContainer.VERSION="0.1.10",e.ChildViewContainer.noConflict=function(){return e.ChildViewContainer=i,this},e.ChildViewContainer})},{"./../../../assets/js/src/admin/vendor/backbone-shim.js":29,"./../../../assets/js/src/admin/vendor/underscore-shim.js":33}],35:[function(t,i,n){!function(r,o){if("function"==typeof e&&e.amd)e(["backbone","underscore","backbone.wreqr","backbone.babysitter"],function(e,t){return r.Marionette=r.Mn=o(r,e,t)});else if("undefined"!=typeof n){var s=t("./../../../../assets/js/src/admin/vendor/backbone-shim.js"),a=t("./../../../../assets/js/src/admin/vendor/underscore-shim.js");t("backbone.wreqr"),t("backbone.babysitter");i.exports=o(r,s,a)}else r.Marionette=r.Mn=o(r,r.Backbone,r._)}(this,function(e,t,i){"use strict";var n=e.Marionette,r=e.Mn,o=t.Marionette={};o.VERSION="2.4.3",o.noConflict=function(){return e.Marionette=n,e.Mn=r,this},o.Deferred=t.$.Deferred,o.FEATURES={},o.isEnabled=function(e){return!!o.FEATURES[e]},o.extend=t.Model.extend,o.isNodeAttached=function(e){return t.$.contains(document.documentElement,e)},o.mergeOptions=function(e,t){e&&i.extend(this,i.pick(e,t))},o.getOption=function(e,t){return e&&t?e.options&&void 0!==e.options[t]?e.options[t]:e[t]:void 0},o.proxyGetOption=function(e){return o.getOption(this,e)},o._getValue=function(e,t,n){return i.isFunction(e)&&(e=n?e.apply(t,n):e.call(t)),e},o.normalizeMethods=function(e){return i.reduce(e,function(e,t,n){return i.isFunction(t)||(t=this[t]),t&&(e[n]=t),e},{},this)},o.normalizeUIString=function(e,t){return e.replace(/@ui\.[a-zA-Z_$0-9]*/g,function(e){return t[e.slice(4)]})},o.normalizeUIKeys=function(e,t){return i.reduce(e,function(e,i,n){var r=o.normalizeUIString(n,t);return e[r]=i,e},{})},o.normalizeUIValues=function(e,t,n){return i.each(e,function(r,s){i.isString(r)?e[s]=o.normalizeUIString(r,t):i.isObject(r)&&i.isArray(n)&&(i.extend(r,o.normalizeUIValues(i.pick(r,n),t)),i.each(n,function(e){var n=r[e];i.isString(n)&&(r[e]=o.normalizeUIString(n,t))}))}),e},o.actAsCollection=function(e,t){var n=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];i.each(n,function(n){e[n]=function(){var e=i.values(i.result(this,t)),r=[e].concat(i.toArray(arguments));return i[n].apply(i,r)}})};var s=o.deprecate=function(e,t){i.isObject(e)&&(e=e.prev+" is going to be removed in the future. Please use "+e.next+" instead."+(e.url?" See: "+e.url:"")),void 0!==t&&t||s._cache[e]||(s._warn("Deprecation warning: "+e),s._cache[e]=!0)};s._warn="undefined"!=typeof console&&(console.warn||console.log)||function(){},s._cache={},o._triggerMethod=function(){function e(e,t,i){return i.toUpperCase()}var t=/(^|:)(\w)/gi;return function(n,r,o){var s=arguments.length<3;s&&(o=r,r=o[0]);var a,h="on"+r.replace(t,e),c=n[h];return i.isFunction(c)&&(a=c.apply(n,s?i.rest(o):o)),i.isFunction(n.trigger)&&(s+o.length>1?n.trigger.apply(n,s?o:[r].concat(i.drop(o,0))):n.trigger(r)),a}}(),o.triggerMethod=function(e){return o._triggerMethod(this,arguments)},o.triggerMethodOn=function(e){var t=i.isFunction(e.triggerMethod)?e.triggerMethod:o.triggerMethod;return t.apply(e,i.rest(arguments))},o.MonitorDOMRefresh=function(e){function t(){e._isShown=!0,n()}function i(){e._isRendered=!0,
n()}function n(){e._isShown&&e._isRendered&&o.isNodeAttached(e.el)&&o.triggerMethodOn(e,"dom:refresh",e)}e._isDomRefreshMonitored||(e._isDomRefreshMonitored=!0,e.on({show:t,render:i}))},function(e){function t(t,n,r,o){var s=o.split(/\s+/);i.each(s,function(i){var o=t[i];if(!o)throw new e.Error('Method "'+i+'" was configured as an event handler, but does not exist.');t.listenTo(n,r,o)})}function n(e,t,i,n){e.listenTo(t,i,n)}function r(e,t,n,r){var o=r.split(/\s+/);i.each(o,function(i){var r=e[i];e.stopListening(t,n,r)})}function o(e,t,i,n){e.stopListening(t,i,n)}function s(t,n,r,o,s){if(n&&r){if(!i.isObject(r))throw new e.Error({message:"Bindings must be an object or function.",url:"marionette.functions.html#marionettebindentityevents"});r=e._getValue(r,t),i.each(r,function(e,r){i.isFunction(e)?o(t,n,r,e):s(t,n,r,e)})}}e.bindEntityEvents=function(e,i,r){s(e,i,r,n,t)},e.unbindEntityEvents=function(e,t,i){s(e,t,i,o,r)},e.proxyBindEntityEvents=function(t,i){return e.bindEntityEvents(this,t,i)},e.proxyUnbindEntityEvents=function(t,i){return e.unbindEntityEvents(this,t,i)}}(o);var a=["description","fileName","lineNumber","name","message","number"];return o.Error=o.extend.call(Error,{urlRoot:"http://marionettejs.com/docs/v"+o.VERSION+"/",constructor:function(e,t){i.isObject(e)?(t=e,e=t.message):t||(t={});var n=Error.call(this,e);i.extend(this,i.pick(n,a),i.pick(t,a)),this.captureStackTrace(),t.url&&(this.url=this.urlRoot+t.url)},captureStackTrace:function(){Error.captureStackTrace&&Error.captureStackTrace(this,o.Error)},toString:function(){return this.name+": "+this.message+(this.url?" See: "+this.url:"")}}),o.Error.extend=o.extend,o.Callbacks=function(){this._deferred=o.Deferred(),this._callbacks=[]},i.extend(o.Callbacks.prototype,{add:function(e,t){var n=i.result(this._deferred,"promise");this._callbacks.push({cb:e,ctx:t}),n.then(function(i){t&&(i.context=t),e.call(i.context,i.options)})},run:function(e,t){this._deferred.resolve({options:e,context:t})},reset:function(){var e=this._callbacks;this._deferred=o.Deferred(),this._callbacks=[],i.each(e,function(e){this.add(e.cb,e.ctx)},this)}}),o.Controller=function(e){this.options=e||{},i.isFunction(this.initialize)&&this.initialize(this.options)},o.Controller.extend=o.extend,i.extend(o.Controller.prototype,t.Events,{destroy:function(){return o._triggerMethod(this,"before:destroy",arguments),o._triggerMethod(this,"destroy",arguments),this.stopListening(),this.off(),this},triggerMethod:o.triggerMethod,mergeOptions:o.mergeOptions,getOption:o.proxyGetOption}),o.Object=function(e){this.options=i.extend({},i.result(this,"options"),e),this.initialize.apply(this,arguments)},o.Object.extend=o.extend,i.extend(o.Object.prototype,t.Events,{initialize:function(){},destroy:function(){return this.triggerMethod("before:destroy"),this.triggerMethod("destroy"),this.stopListening(),this},triggerMethod:o.triggerMethod,mergeOptions:o.mergeOptions,getOption:o.proxyGetOption,bindEntityEvents:o.proxyBindEntityEvents,unbindEntityEvents:o.proxyUnbindEntityEvents}),o.Region=o.Object.extend({constructor:function(e){if(this.options=e||{},this.el=this.getOption("el"),this.el=this.el instanceof t.$?this.el[0]:this.el,!this.el)throw new o.Error({name:"NoElError",message:'An "el" must be specified for a region.'});this.$el=this.getEl(this.el),o.Object.call(this,e)},show:function(e,t){if(this._ensureElement()){this._ensureViewIsIntact(e),o.MonitorDOMRefresh(e);var n=t||{},r=e!==this.currentView,s=!!n.preventDestroy,a=!!n.forceShow,h=!!this.currentView,c=r&&!s,l=r||a;if(h&&this.triggerMethod("before:swapOut",this.currentView,this,t),this.currentView&&delete this.currentView._parent,c?this.empty():h&&l&&this.currentView.off("destroy",this.empty,this),l){e.once("destroy",this.empty,this),this._renderView(e),e._parent=this,h&&this.triggerMethod("before:swap",e,this,t),this.triggerMethod("before:show",e,this,t),o.triggerMethodOn(e,"before:show",e,this,t),h&&this.triggerMethod("swapOut",this.currentView,this,t);var u=o.isNodeAttached(this.el),d=[],f=i.extend({triggerBeforeAttach:this.triggerBeforeAttach,triggerAttach:this.triggerAttach},n);return u&&f.triggerBeforeAttach&&(d=this._displayedViews(e),this._triggerAttach(d,"before:")),this.attachHtml(e),this.currentView=e,u&&f.triggerAttach&&(d=this._displayedViews(e),this._triggerAttach(d)),h&&this.triggerMethod("swap",e,this,t),this.triggerMethod("show",e,this,t),o.triggerMethodOn(e,"show",e,this,t),this}return this}},triggerBeforeAttach:!0,triggerAttach:!0,_triggerAttach:function(e,t){var n=(t||"")+"attach";i.each(e,function(e){o.triggerMethodOn(e,n,e,this)},this)},_displayedViews:function(e){return i.union([e],i.result(e,"_getNestedViews")||[])},_renderView:function(e){e.supportsRenderLifecycle||o.triggerMethodOn(e,"before:render",e),e.render(),e.supportsRenderLifecycle||o.triggerMethodOn(e,"render",e)},_ensureElement:function(){if(i.isObject(this.el)||(this.$el=this.getEl(this.el),this.el=this.$el[0]),!this.$el||0===this.$el.length){if(this.getOption("allowMissingEl"))return!1;throw new o.Error('An "el" '+this.$el.selector+" must exist in DOM")}return!0},_ensureViewIsIntact:function(e){if(!e)throw new o.Error({name:"ViewNotValid",message:"The view passed is undefined and therefore invalid. You must pass a view instance to show."});if(e.isDestroyed)throw new o.Error({name:"ViewDestroyedError",message:'View (cid: "'+e.cid+'") has already been destroyed and cannot be used.'})},getEl:function(e){return t.$(e,o._getValue(this.options.parentEl,this))},attachHtml:function(e){this.$el.contents().detach(),this.el.appendChild(e.el)},empty:function(e){var t=this.currentView,i=e||{},n=!!i.preventDestroy;return t?(t.off("destroy",this.empty,this),this.triggerMethod("before:empty",t),n||this._destroyView(),this.triggerMethod("empty",t),delete this.currentView,n&&this.$el.contents().detach(),this):void 0},_destroyView:function(){var e=this.currentView;e.isDestroyed||(e.supportsDestroyLifecycle||o.triggerMethodOn(e,"before:destroy",e),e.destroy?e.destroy():(e.remove(),e.isDestroyed=!0),e.supportsDestroyLifecycle||o.triggerMethodOn(e,"destroy",e))},attachView:function(e){return this.currentView&&delete this.currentView._parent,e._parent=this,this.currentView=e,this},hasView:function(){return!!this.currentView},reset:function(){return this.empty(),this.$el&&(this.el=this.$el.selector),delete this.$el,this}},{buildRegion:function(e,t){if(i.isString(e))return this._buildRegionFromSelector(e,t);if(e.selector||e.el||e.regionClass)return this._buildRegionFromObject(e,t);if(i.isFunction(e))return this._buildRegionFromRegionClass(e);throw new o.Error({message:"Improper region configuration type.",url:"marionette.region.html#region-configuration-types"})},_buildRegionFromSelector:function(e,t){return new t({el:e})},_buildRegionFromObject:function(e,t){var n=e.regionClass||t,r=i.omit(e,"selector","regionClass");return e.selector&&!r.el&&(r.el=e.selector),new n(r)},_buildRegionFromRegionClass:function(e){return new e}}),o.RegionManager=o.Controller.extend({constructor:function(e){this._regions={},this.length=0,o.Controller.call(this,e),this.addRegions(this.getOption("regions"))},addRegions:function(e,t){return e=o._getValue(e,this,arguments),i.reduce(e,function(e,n,r){return i.isString(n)&&(n={selector:n}),n.selector&&(n=i.defaults({},n,t)),e[r]=this.addRegion(r,n),e},{},this)},addRegion:function(e,t){var i;return i=t instanceof o.Region?t:o.Region.buildRegion(t,o.Region),this.triggerMethod("before:add:region",e,i),i._parent=this,this._store(e,i),this.triggerMethod("add:region",e,i),i},get:function(e){return this._regions[e]},getRegions:function(){return i.clone(this._regions)},removeRegion:function(e){var t=this._regions[e];return this._remove(e,t),t},removeRegions:function(){var e=this.getRegions();return i.each(this._regions,function(e,t){this._remove(t,e)},this),e},emptyRegions:function(){var e=this.getRegions();return i.invoke(e,"empty"),e},destroy:function(){return this.removeRegions(),o.Controller.prototype.destroy.apply(this,arguments)},_store:function(e,t){this._regions[e]||this.length++,this._regions[e]=t},_remove:function(e,t){this.triggerMethod("before:remove:region",e,t),t.empty(),t.stopListening(),delete t._parent,delete this._regions[e],this.length--,this.triggerMethod("remove:region",e,t)}}),o.actAsCollection(o.RegionManager.prototype,"_regions"),o.TemplateCache=function(e){this.templateId=e},i.extend(o.TemplateCache,{templateCaches:{},get:function(e,t){var i=this.templateCaches[e];return i||(i=new o.TemplateCache(e),this.templateCaches[e]=i),i.load(t)},clear:function(){var e,t=i.toArray(arguments),n=t.length;if(n>0)for(e=0;n>e;e++)delete this.templateCaches[t[e]];else this.templateCaches={}}}),i.extend(o.TemplateCache.prototype,{load:function(e){if(this.compiledTemplate)return this.compiledTemplate;var t=this.loadTemplate(this.templateId,e);return this.compiledTemplate=this.compileTemplate(t,e),this.compiledTemplate},loadTemplate:function(e,i){var n=t.$(e);if(!n.length)throw new o.Error({name:"NoTemplateError",message:'Could not find template: "'+e+'"'});return n.html()},compileTemplate:function(e,t){return i.template(e,t)}}),o.Renderer={render:function(e,t){if(!e)throw new o.Error({name:"TemplateNotFoundError",message:"Cannot render the template since its false, null or undefined."});var n=i.isFunction(e)?e:o.TemplateCache.get(e);return n(t)}},o.View=t.View.extend({isDestroyed:!1,supportsRenderLifecycle:!0,supportsDestroyLifecycle:!0,constructor:function(e){this.render=i.bind(this.render,this),e=o._getValue(e,this),this.options=i.extend({},i.result(this,"options"),e),this._behaviors=o.Behaviors(this),t.View.call(this,this.options),o.MonitorDOMRefresh(this)},getTemplate:function(){return this.getOption("template")},serializeModel:function(e){return e.toJSON.apply(e,i.rest(arguments))},mixinTemplateHelpers:function(e){e=e||{};var t=this.getOption("templateHelpers");return t=o._getValue(t,this),i.extend(e,t)},normalizeUIKeys:function(e){var t=i.result(this,"_uiBindings");return o.normalizeUIKeys(e,t||i.result(this,"ui"))},normalizeUIValues:function(e,t){var n=i.result(this,"ui"),r=i.result(this,"_uiBindings");return o.normalizeUIValues(e,r||n,t)},configureTriggers:function(){if(this.triggers){var e=this.normalizeUIKeys(i.result(this,"triggers"));return i.reduce(e,function(e,t,i){return e[i]=this._buildViewTrigger(t),e},{},this)}},delegateEvents:function(e){return this._delegateDOMEvents(e),this.bindEntityEvents(this.model,this.getOption("modelEvents")),this.bindEntityEvents(this.collection,this.getOption("collectionEvents")),i.each(this._behaviors,function(e){e.bindEntityEvents(this.model,e.getOption("modelEvents")),e.bindEntityEvents(this.collection,e.getOption("collectionEvents"))},this),this},_delegateDOMEvents:function(e){var n=o._getValue(e||this.events,this);n=this.normalizeUIKeys(n),i.isUndefined(e)&&(this.events=n);var r={},s=i.result(this,"behaviorEvents")||{},a=this.configureTriggers(),h=i.result(this,"behaviorTriggers")||{};i.extend(r,s,n,a,h),t.View.prototype.delegateEvents.call(this,r)},undelegateEvents:function(){return t.View.prototype.undelegateEvents.apply(this,arguments),this.unbindEntityEvents(this.model,this.getOption("modelEvents")),this.unbindEntityEvents(this.collection,this.getOption("collectionEvents")),i.each(this._behaviors,function(e){e.unbindEntityEvents(this.model,e.getOption("modelEvents")),e.unbindEntityEvents(this.collection,e.getOption("collectionEvents"))},this),this},_ensureViewIsIntact:function(){if(this.isDestroyed)throw new o.Error({name:"ViewDestroyedError",message:'View (cid: "'+this.cid+'") has already been destroyed and cannot be used.'})},destroy:function(){if(this.isDestroyed)return this;var e=i.toArray(arguments);return this.triggerMethod.apply(this,["before:destroy"].concat(e)),this.isDestroyed=!0,this.triggerMethod.apply(this,["destroy"].concat(e)),this.unbindUIElements(),this.isRendered=!1,this.remove(),i.invoke(this._behaviors,"destroy",e),this},bindUIElements:function(){this._bindUIElements(),i.invoke(this._behaviors,this._bindUIElements)},_bindUIElements:function(){if(this.ui){this._uiBindings||(this._uiBindings=this.ui);var e=i.result(this,"_uiBindings");this.ui={},i.each(e,function(e,t){this.ui[t]=this.$(e)},this)}},unbindUIElements:function(){this._unbindUIElements(),i.invoke(this._behaviors,this._unbindUIElements)},_unbindUIElements:function(){this.ui&&this._uiBindings&&(i.each(this.ui,function(e,t){delete this.ui[t]},this),this.ui=this._uiBindings,delete this._uiBindings)},_buildViewTrigger:function(e){var t=i.defaults({},e,{preventDefault:!0,stopPropagation:!0}),n=i.isObject(e)?t.event:e;return function(e){e&&(e.preventDefault&&t.preventDefault&&e.preventDefault(),e.stopPropagation&&t.stopPropagation&&e.stopPropagation());var i={view:this,model:this.model,collection:this.collection};this.triggerMethod(n,i)}},setElement:function(){var e=t.View.prototype.setElement.apply(this,arguments);return i.invoke(this._behaviors,"proxyViewProperties",this),e},triggerMethod:function(){var e=o._triggerMethod(this,arguments);return this._triggerEventOnBehaviors(arguments),this._triggerEventOnParentLayout(arguments[0],i.rest(arguments)),e},_triggerEventOnBehaviors:function(e){for(var t=o._triggerMethod,i=this._behaviors,n=0,r=i&&i.length;r>n;n++)t(i[n],e)},_triggerEventOnParentLayout:function(e,t){var n=this._parentLayoutView();if(n){var r=o.getOption(n,"childViewEventPrefix"),s=r+":"+e,a=[this].concat(t);o._triggerMethod(n,s,a);var h=o.getOption(n,"childEvents"),c=n.normalizeMethods(h);c&&i.isFunction(c[e])&&c[e].apply(n,a)}},_getImmediateChildren:function(){return[]},_getNestedViews:function(){var e=this._getImmediateChildren();return e.length?i.reduce(e,function(e,t){return t._getNestedViews?e.concat(t._getNestedViews()):e},e):e},_getAncestors:function(){for(var e=[],t=this._parent;t;)e.push(t),t=t._parent;return e},_parentLayoutView:function(){var e=this._getAncestors();return i.find(e,function(e){return e instanceof o.LayoutView})},normalizeMethods:o.normalizeMethods,mergeOptions:o.mergeOptions,getOption:o.proxyGetOption,bindEntityEvents:o.proxyBindEntityEvents,unbindEntityEvents:o.proxyUnbindEntityEvents}),o.ItemView=o.View.extend({constructor:function(){o.View.apply(this,arguments)},serializeData:function(){if(!this.model&&!this.collection)return{};var e=[this.model||this.collection];return arguments.length&&e.push.apply(e,arguments),this.model?this.serializeModel.apply(this,e):{items:this.serializeCollection.apply(this,e)}},serializeCollection:function(e){return e.toJSON.apply(e,i.rest(arguments))},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderTemplate(),this.isRendered=!0,this.bindUIElements(),this.triggerMethod("render",this),this},_renderTemplate:function(){var e=this.getTemplate();if(e!==!1){if(!e)throw new o.Error({name:"UndefinedTemplateError",message:"Cannot render the template since it is null or undefined."});var t=this.mixinTemplateHelpers(this.serializeData()),i=o.Renderer.render(e,t,this);return this.attachElContent(i),this}},attachElContent:function(e){return this.$el.html(e),this}}),o.CollectionView=o.View.extend({childViewEventPrefix:"childview",sort:!0,constructor:function(e){this.once("render",this._initialEvents),this._initChildViewStorage(),o.View.apply(this,arguments),this.on({"before:show":this._onBeforeShowCalled,show:this._onShowCalled,"before:attach":this._onBeforeAttachCalled,attach:this._onAttachCalled}),this.initRenderBuffer()},initRenderBuffer:function(){this._bufferedChildren=[]},startBuffering:function(){this.initRenderBuffer(),this.isBuffering=!0},endBuffering:function(){var e,t=this._isShown&&o.isNodeAttached(this.el);this.isBuffering=!1,this._isShown&&this._triggerMethodMany(this._bufferedChildren,this,"before:show"),t&&this._triggerBeforeAttach&&(e=this._getNestedViews(),this._triggerMethodMany(e,this,"before:attach")),this.attachBuffer(this,this._createBuffer()),t&&this._triggerAttach&&(e=this._getNestedViews(),this._triggerMethodMany(e,this,"attach")),this._isShown&&this._triggerMethodMany(this._bufferedChildren,this,"show"),this.initRenderBuffer()},_triggerMethodMany:function(e,t,n){var r=i.drop(arguments,3);i.each(e,function(e){o.triggerMethodOn.apply(e,[e,n,e,t].concat(r))})},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this.render),this.getOption("sort")&&this.listenTo(this.collection,"sort",this._sortViews))},_onCollectionAdd:function(e,t,n){var r=void 0!==n.at&&(n.index||t.indexOf(e));if((this.getOption("filter")||r===!1)&&(r=i.indexOf(this._filteredSortedModels(r),e)),this._shouldAddChild(e,r)){this.destroyEmptyView();var o=this.getChildView(e);this.addChild(e,o,r)}},_onCollectionRemove:function(e){var t=this.children.findByModel(e);this.removeChildView(t),this.checkEmpty()},_onBeforeShowCalled:function(){this._triggerBeforeAttach=this._triggerAttach=!1,this.children.each(function(e){o.triggerMethodOn(e,"before:show",e)})},_onShowCalled:function(){this.children.each(function(e){o.triggerMethodOn(e,"show",e)})},_onBeforeAttachCalled:function(){this._triggerBeforeAttach=!0},_onAttachCalled:function(){this._triggerAttach=!0},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderChildren(),this.isRendered=!0,this.triggerMethod("render",this),this},reorder:function(){var e=this.children,t=this._filteredSortedModels(),n=i.find(t,function(t){return!e.findByModel(t)});if(n)this.render();else{var r=i.map(t,function(t,i){var n=e.findByModel(t);return n._index=i,n.el});this.triggerMethod("before:reorder"),this._appendReorderedChildren(r),this.triggerMethod("reorder")}},resortView:function(){o.getOption(this,"reorderOnSort")?this.reorder():this.render()},_sortViews:function(){var e=this._filteredSortedModels(),t=i.find(e,function(e,t){var i=this.children.findByModel(e);return!i||i._index!==t},this);t&&this.resortView()},_emptyViewIndex:-1,_appendReorderedChildren:function(e){this.$el.append(e)},_renderChildren:function(){this.destroyEmptyView(),this.destroyChildren({checkEmpty:!1}),this.isEmpty(this.collection)?this.showEmptyView():(this.triggerMethod("before:render:collection",this),this.startBuffering(),this.showCollection(),this.endBuffering(),this.triggerMethod("render:collection",this),this.children.isEmpty()&&this.getOption("filter")&&this.showEmptyView())},showCollection:function(){var e,t=this._filteredSortedModels();i.each(t,function(t,i){e=this.getChildView(t),this.addChild(t,e,i)},this)},_filteredSortedModels:function(e){var t=this.getViewComparator(),n=this.collection.models;if(e=Math.min(Math.max(e,0),n.length-1),t){var r;e&&(r=n[e],n=n.slice(0,e).concat(n.slice(e+1))),n=this._sortModelsBy(n,t),r&&n.splice(e,0,r)}return this.getOption("filter")&&(n=i.filter(n,function(e,t){return this._shouldAddChild(e,t)},this)),n},_sortModelsBy:function(e,t){return"string"==typeof t?i.sortBy(e,function(e){return e.get(t)},this):1===t.length?i.sortBy(e,t,this):e.sort(i.bind(t,this))},showEmptyView:function(){var e=this.getEmptyView();if(e&&!this._showingEmptyView){this.triggerMethod("before:render:empty"),this._showingEmptyView=!0;var i=new t.Model;this.addEmptyView(i,e),this.triggerMethod("render:empty")}},destroyEmptyView:function(){this._showingEmptyView&&(this.triggerMethod("before:remove:empty"),this.destroyChildren(),delete this._showingEmptyView,this.triggerMethod("remove:empty"))},getEmptyView:function(){return this.getOption("emptyView")},addEmptyView:function(e,t){var n,r=this._isShown&&!this.isBuffering&&o.isNodeAttached(this.el),s=this.getOption("emptyViewOptions")||this.getOption("childViewOptions");i.isFunction(s)&&(s=s.call(this,e,this._emptyViewIndex));var a=this.buildChildView(e,t,s);a._parent=this,this.proxyChildEvents(a),a.once("render",function(){this._isShown&&o.triggerMethodOn(a,"before:show",a),r&&this._triggerBeforeAttach&&(n=this._getViewAndNested(a),this._triggerMethodMany(n,this,"before:attach"))},this),this.children.add(a),this.renderChildView(a,this._emptyViewIndex),r&&this._triggerAttach&&(n=this._getViewAndNested(a),this._triggerMethodMany(n,this,"attach")),this._isShown&&o.triggerMethodOn(a,"show",a)},getChildView:function(e){var t=this.getOption("childView");if(!t)throw new o.Error({name:"NoChildViewError",message:'A "childView" must be specified'});return t},addChild:function(e,t,i){var n=this.getOption("childViewOptions");n=o._getValue(n,this,[e,i]);var r=this.buildChildView(e,t,n);return this._updateIndices(r,!0,i),this.triggerMethod("before:add:child",r),this._addChildView(r,i),this.triggerMethod("add:child",r),r._parent=this,r},_updateIndices:function(e,t,i){this.getOption("sort")&&(t&&(e._index=i),this.children.each(function(i){i._index>=e._index&&(i._index+=t?1:-1)}))},_addChildView:function(e,t){var i,n=this._isShown&&!this.isBuffering&&o.isNodeAttached(this.el);this.proxyChildEvents(e),e.once("render",function(){this._isShown&&!this.isBuffering&&o.triggerMethodOn(e,"before:show",e),n&&this._triggerBeforeAttach&&(i=this._getViewAndNested(e),this._triggerMethodMany(i,this,"before:attach"))},this),this.children.add(e),this.renderChildView(e,t),n&&this._triggerAttach&&(i=this._getViewAndNested(e),this._triggerMethodMany(i,this,"attach")),this._isShown&&!this.isBuffering&&o.triggerMethodOn(e,"show",e)},renderChildView:function(e,t){return e.supportsRenderLifecycle||o.triggerMethodOn(e,"before:render",e),e.render(),e.supportsRenderLifecycle||o.triggerMethodOn(e,"render",e),this.attachHtml(this,e,t),e},buildChildView:function(e,t,n){var r=i.extend({model:e},n),s=new t(r);return o.MonitorDOMRefresh(s),s},removeChildView:function(e){return e?(this.triggerMethod("before:remove:child",e),e.supportsDestroyLifecycle||o.triggerMethodOn(e,"before:destroy",e),e.destroy?e.destroy():e.remove(),e.supportsDestroyLifecycle||o.triggerMethodOn(e,"destroy",e),delete e._parent,this.stopListening(e),this.children.remove(e),this.triggerMethod("remove:child",e),this._updateIndices(e,!1),e):e},isEmpty:function(){return!this.collection||0===this.collection.length},checkEmpty:function(){this.isEmpty(this.collection)&&this.showEmptyView()},attachBuffer:function(e,t){e.$el.append(t)},_createBuffer:function(){var e=document.createDocumentFragment();return i.each(this._bufferedChildren,function(t){e.appendChild(t.el)}),e},attachHtml:function(e,t,i){e.isBuffering?e._bufferedChildren.splice(i,0,t):e._insertBefore(t,i)||e._insertAfter(t)},_insertBefore:function(e,t){var i,n=this.getOption("sort")&&t<this.children.length-1;return n&&(i=this.children.find(function(e){return e._index===t+1})),i?(i.$el.before(e.el),!0):!1},_insertAfter:function(e){this.$el.append(e.el)},_initChildViewStorage:function(){this.children=new t.ChildViewContainer},destroy:function(){return this.isDestroyed?this:(this.triggerMethod("before:destroy:collection"),this.destroyChildren({checkEmpty:!1}),this.triggerMethod("destroy:collection"),o.View.prototype.destroy.apply(this,arguments))},destroyChildren:function(e){var t=e||{},n=!0,r=this.children.map(i.identity);return i.isUndefined(t.checkEmpty)||(n=t.checkEmpty),this.children.each(this.removeChildView,this),n&&this.checkEmpty(),r},_shouldAddChild:function(e,t){var n=this.getOption("filter");return!i.isFunction(n)||n.call(this,e,t,this.collection)},proxyChildEvents:function(e){var t=this.getOption("childViewEventPrefix");this.listenTo(e,"all",function(){var n=i.toArray(arguments),r=n[0],o=this.normalizeMethods(i.result(this,"childEvents"));n[0]=t+":"+r,n.splice(1,0,e),"undefined"!=typeof o&&i.isFunction(o[r])&&o[r].apply(this,n.slice(1)),this.triggerMethod.apply(this,n)})},_getImmediateChildren:function(){return i.values(this.children._views)},_getViewAndNested:function(e){return[e].concat(i.result(e,"_getNestedViews")||[])},getViewComparator:function(){return this.getOption("viewComparator")}}),o.CompositeView=o.CollectionView.extend({constructor:function(){o.CollectionView.apply(this,arguments)},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this._renderChildren),this.getOption("sort")&&this.listenTo(this.collection,"sort",this._sortViews))},getChildView:function(e){var t=this.getOption("childView")||this.constructor;return t},serializeData:function(){var e={};return this.model&&(e=i.partial(this.serializeModel,this.model).apply(this,arguments)),e},render:function(){return this._ensureViewIsIntact(),this._isRendering=!0,this.resetChildViewContainer(),this.triggerMethod("before:render",this),this._renderTemplate(),this._renderChildren(),this._isRendering=!1,this.isRendered=!0,this.triggerMethod("render",this),this},_renderChildren:function(){(this.isRendered||this._isRendering)&&o.CollectionView.prototype._renderChildren.call(this)},_renderTemplate:function(){var e={};e=this.serializeData(),e=this.mixinTemplateHelpers(e),this.triggerMethod("before:render:template");var t=this.getTemplate(),i=o.Renderer.render(t,e,this);this.attachElContent(i),this.bindUIElements(),this.triggerMethod("render:template")},attachElContent:function(e){return this.$el.html(e),this},attachBuffer:function(e,t){var i=this.getChildViewContainer(e);i.append(t)},_insertAfter:function(e){var t=this.getChildViewContainer(this,e);t.append(e.el)},_appendReorderedChildren:function(e){var t=this.getChildViewContainer(this);t.append(e)},getChildViewContainer:function(e,t){if(e.$childViewContainer)return e.$childViewContainer;var i,n=o.getOption(e,"childViewContainer");if(n){var r=o._getValue(n,e);if(i="@"===r.charAt(0)&&e.ui?e.ui[r.substr(4)]:e.$(r),i.length<=0)throw new o.Error({name:"ChildViewContainerMissingError",message:'The specified "childViewContainer" was not found: '+e.childViewContainer})}else i=e.$el;return e.$childViewContainer=i,i},resetChildViewContainer:function(){this.$childViewContainer&&(this.$childViewContainer=void 0)}}),o.LayoutView=o.ItemView.extend({regionClass:o.Region,options:{destroyImmediate:!1},childViewEventPrefix:"childview",constructor:function(e){e=e||{},this._firstRender=!0,this._initializeRegions(e),o.ItemView.call(this,e)},render:function(){return this._ensureViewIsIntact(),this._firstRender?this._firstRender=!1:this._reInitializeRegions(),o.ItemView.prototype.render.apply(this,arguments)},destroy:function(){return this.isDestroyed?this:(this.getOption("destroyImmediate")===!0&&this.$el.remove(),this.regionManager.destroy(),o.ItemView.prototype.destroy.apply(this,arguments))},showChildView:function(e,t){return this.getRegion(e).show(t)},getChildView:function(e){return this.getRegion(e).currentView},addRegion:function(e,t){var i={};return i[e]=t,this._buildRegions(i)[e]},addRegions:function(e){return this.regions=i.extend({},this.regions,e),this._buildRegions(e)},removeRegion:function(e){return delete this.regions[e],this.regionManager.removeRegion(e)},getRegion:function(e){return this.regionManager.get(e)},getRegions:function(){return this.regionManager.getRegions()},_buildRegions:function(e){var t={regionClass:this.getOption("regionClass"),parentEl:i.partial(i.result,this,"el")};return this.regionManager.addRegions(e,t)},_initializeRegions:function(e){var t;this._initRegionManager(),t=o._getValue(this.regions,this,[e])||{};var n=this.getOption.call(e,"regions");n=o._getValue(n,this,[e]),i.extend(t,n),t=this.normalizeUIValues(t,["selector","el"]),this.addRegions(t)},_reInitializeRegions:function(){this.regionManager.invoke("reset")},getRegionManager:function(){return new o.RegionManager},_initRegionManager:function(){this.regionManager=this.getRegionManager(),this.regionManager._parent=this,this.listenTo(this.regionManager,"before:add:region",function(e){this.triggerMethod("before:add:region",e)}),this.listenTo(this.regionManager,"add:region",function(e,t){this[e]=t,this.triggerMethod("add:region",e,t)}),this.listenTo(this.regionManager,"before:remove:region",function(e){this.triggerMethod("before:remove:region",e)}),this.listenTo(this.regionManager,"remove:region",function(e,t){delete this[e],this.triggerMethod("remove:region",e,t)})},_getImmediateChildren:function(){return i.chain(this.regionManager.getRegions()).pluck("currentView").compact().value()}}),o.Behavior=o.Object.extend({constructor:function(e,t){this.view=t,this.defaults=i.result(this,"defaults")||{},this.options=i.extend({},this.defaults,e),this.ui=i.extend({},i.result(t,"ui"),i.result(this,"ui")),o.Object.apply(this,arguments)},$:function(){return this.view.$.apply(this.view,arguments)},destroy:function(){return this.stopListening(),this},proxyViewProperties:function(e){this.$el=e.$el,this.el=e.el}}),o.Behaviors=function(e,t){function i(e,n){return t.isObject(e.behaviors)?(n=i.parseBehaviors(e,n||t.result(e,"behaviors")),i.wrap(e,n,t.keys(s)),n):{}}function n(e,t){this._view=e,this._behaviors=t,this._triggers={}}function r(e){return e._uiBindings||e.ui}var o=/^(\S+)\s*(.*)$/,s={behaviorTriggers:function(e,t){var i=new n(this,t);return i.buildBehaviorTriggers()},behaviorEvents:function(i,n){var s={};return t.each(n,function(i,n){var a={},h=t.clone(t.result(i,"events"))||{};h=e.normalizeUIKeys(h,r(i));var c=0;t.each(h,function(e,r){var s=r.match(o),h=s[1]+"."+[this.cid,n,c++," "].join(""),l=s[2],u=h+l,d=t.isFunction(e)?e:i[e];a[u]=t.bind(d,i)},this),s=t.extend(s,a)},this),s}};return t.extend(i,{behaviorsLookup:function(){throw new e.Error({message:"You must define where your behaviors are stored.",url:"marionette.behaviors.html#behaviorslookup"})},getBehaviorClass:function(t,n){return t.behaviorClass?t.behaviorClass:e._getValue(i.behaviorsLookup,this,[t,n])[n]},parseBehaviors:function(e,n){return t.chain(n).map(function(n,r){var o=i.getBehaviorClass(n,r),s=new o(n,e),a=i.parseBehaviors(e,t.result(s,"behaviors"));return[s].concat(a)}).flatten().value()},wrap:function(e,i,n){t.each(n,function(n){e[n]=t.partial(s[n],e[n],i)})}}),t.extend(n.prototype,{buildBehaviorTriggers:function(){return t.each(this._behaviors,this._buildTriggerHandlersForBehavior,this),this._triggers},_buildTriggerHandlersForBehavior:function(i,n){var o=t.clone(t.result(i,"triggers"))||{};o=e.normalizeUIKeys(o,r(i)),t.each(o,t.bind(this._setHandlerForBehavior,this,i,n))},_setHandlerForBehavior:function(e,t,i,n){var r=n.replace(/^\S+/,function(e){return e+".behaviortriggers"+t});this._triggers[r]=this._view._buildViewTrigger(i)}}),i}(o,i),o.AppRouter=t.Router.extend({constructor:function(e){this.options=e||{},t.Router.apply(this,arguments);var i=this.getOption("appRoutes"),n=this._getController();this.processAppRoutes(n,i),this.on("route",this._processOnRoute,this)},appRoute:function(e,t){var i=this._getController();this._addAppRoute(i,e,t)},_processOnRoute:function(e,t){if(i.isFunction(this.onRoute)){var n=i.invert(this.getOption("appRoutes"))[e];this.onRoute(e,n,t)}},processAppRoutes:function(e,t){if(t){var n=i.keys(t).reverse();i.each(n,function(i){this._addAppRoute(e,i,t[i])},this)}},_getController:function(){return this.getOption("controller")},_addAppRoute:function(e,t,n){var r=e[n];if(!r)throw new o.Error('Method "'+n+'" was not found on the controller');this.route(t,n,i.bind(r,e))},mergeOptions:o.mergeOptions,getOption:o.proxyGetOption,triggerMethod:o.triggerMethod,bindEntityEvents:o.proxyBindEntityEvents,unbindEntityEvents:o.proxyUnbindEntityEvents}),o.Application=o.Object.extend({constructor:function(e){this._initializeRegions(e),this._initCallbacks=new o.Callbacks,this.submodules={},i.extend(this,e),this._initChannel(),o.Object.apply(this,arguments)},execute:function(){this.commands.execute.apply(this.commands,arguments)},request:function(){return this.reqres.request.apply(this.reqres,arguments)},addInitializer:function(e){this._initCallbacks.add(e)},start:function(e){this.triggerMethod("before:start",e),this._initCallbacks.run(e,this),this.triggerMethod("start",e)},addRegions:function(e){
return this._regionManager.addRegions(e)},emptyRegions:function(){return this._regionManager.emptyRegions()},removeRegion:function(e){return this._regionManager.removeRegion(e)},getRegion:function(e){return this._regionManager.get(e)},getRegions:function(){return this._regionManager.getRegions()},module:function(e,t){var n=o.Module.getClass(t),r=i.toArray(arguments);return r.unshift(this),n.create.apply(n,r)},getRegionManager:function(){return new o.RegionManager},_initializeRegions:function(e){var t=i.isFunction(this.regions)?this.regions(e):this.regions||{};this._initRegionManager();var n=o.getOption(e,"regions");return i.isFunction(n)&&(n=n.call(this,e)),i.extend(t,n),this.addRegions(t),this},_initRegionManager:function(){this._regionManager=this.getRegionManager(),this._regionManager._parent=this,this.listenTo(this._regionManager,"before:add:region",function(){o._triggerMethod(this,"before:add:region",arguments)}),this.listenTo(this._regionManager,"add:region",function(e,t){this[e]=t,o._triggerMethod(this,"add:region",arguments)}),this.listenTo(this._regionManager,"before:remove:region",function(){o._triggerMethod(this,"before:remove:region",arguments)}),this.listenTo(this._regionManager,"remove:region",function(e){delete this[e],o._triggerMethod(this,"remove:region",arguments)})},_initChannel:function(){this.channelName=i.result(this,"channelName")||"global",this.channel=i.result(this,"channel")||t.Wreqr.radio.channel(this.channelName),this.vent=i.result(this,"vent")||this.channel.vent,this.commands=i.result(this,"commands")||this.channel.commands,this.reqres=i.result(this,"reqres")||this.channel.reqres}}),o.Module=function(e,t,n){this.moduleName=e,this.options=i.extend({},this.options,n),this.initialize=n.initialize||this.initialize,this.submodules={},this._setupInitializersAndFinalizers(),this.app=t,i.isFunction(this.initialize)&&this.initialize(e,t,this.options)},o.Module.extend=o.extend,i.extend(o.Module.prototype,t.Events,{startWithParent:!0,initialize:function(){},addInitializer:function(e){this._initializerCallbacks.add(e)},addFinalizer:function(e){this._finalizerCallbacks.add(e)},start:function(e){this._isInitialized||(i.each(this.submodules,function(t){t.startWithParent&&t.start(e)}),this.triggerMethod("before:start",e),this._initializerCallbacks.run(e,this),this._isInitialized=!0,this.triggerMethod("start",e))},stop:function(){this._isInitialized&&(this._isInitialized=!1,this.triggerMethod("before:stop"),i.invoke(this.submodules,"stop"),this._finalizerCallbacks.run(void 0,this),this._initializerCallbacks.reset(),this._finalizerCallbacks.reset(),this.triggerMethod("stop"))},addDefinition:function(e,t){this._runModuleDefinition(e,t)},_runModuleDefinition:function(e,n){if(e){var r=i.flatten([this,this.app,t,o,t.$,i,n]);e.apply(this,r)}},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new o.Callbacks,this._finalizerCallbacks=new o.Callbacks},triggerMethod:o.triggerMethod}),i.extend(o.Module,{create:function(e,t,n){var r=e,o=i.drop(arguments,3);t=t.split(".");var s=t.length,a=[];return a[s-1]=n,i.each(t,function(t,i){var s=r;r=this._getModule(s,t,e,n),this._addModuleDefinition(s,r,a[i],o)},this),r},_getModule:function(e,t,n,r,o){var s=i.extend({},r),a=this.getClass(r),h=e[t];return h||(h=new a(t,n,s),e[t]=h,e.submodules[t]=h),h},getClass:function(e){var t=o.Module;return e?e.prototype instanceof t?e:e.moduleClass||t:t},_addModuleDefinition:function(e,t,i,n){var r=this._getDefine(i),o=this._getStartWithParent(i,t);r&&t.addDefinition(r,n),this._addStartWithParent(e,t,o)},_getStartWithParent:function(e,t){var n;return i.isFunction(e)&&e.prototype instanceof o.Module?(n=t.constructor.prototype.startWithParent,i.isUndefined(n)?!0:n):i.isObject(e)?(n=e.startWithParent,i.isUndefined(n)?!0:n):!0},_getDefine:function(e){return!i.isFunction(e)||e.prototype instanceof o.Module?i.isObject(e)?e.define:null:e},_addStartWithParent:function(e,t,i){t.startWithParent=t.startWithParent&&i,t.startWithParent&&!t.startWithParentIsConfigured&&(t.startWithParentIsConfigured=!0,e.addInitializer(function(e){t.startWithParent&&t.start(e)}))}}),o})},{"./../../../../assets/js/src/admin/vendor/backbone-shim.js":29,"./../../../../assets/js/src/admin/vendor/underscore-shim.js":33,"backbone.babysitter":34,"backbone.wreqr":38}],36:[function(t,i,n){!function(r,o){"object"==typeof n&&"undefined"!=typeof i?i.exports=o(t("./../../../assets/js/src/admin/vendor/underscore-shim.js"),t("./../../../assets/js/src/admin/vendor/backbone-shim.js")):"function"==typeof e&&e.amd?e(["underscore","backbone"],o):r.Backbone.Radio=o(r._,r.Backbone)}(this,function(e,t){"use strict";function i(e,t,i,n){var r=e[t];return i&&i!==r.callback&&i!==r.callback._callback||n&&n!==r.context?void 0:(delete e[t],!0)}function n(t,n,r,o){t||(t={});for(var s=n?[n]:e.keys(t),a=!1,h=0,c=s.length;c>h;h++)n=s[h],t[n]&&i(t,n,r,o)&&(a=!0);return a}function r(t){return c[t]||(c[t]=e.partial(a.log,t))}function o(t){return e.isFunction(t)?t:function(){return t}}var s=t.Radio,a=t.Radio={};a.VERSION="1.0.2",a.noConflict=function(){return t.Radio=s,this},a.DEBUG=!1,a._debugText=function(e,t,i){return e+(i?" on the "+i+" channel":"")+': "'+t+'"'},a.debugLog=function(e,t,i){a.DEBUG&&console&&console.warn&&console.warn(a._debugText(e,t,i))};var h=/\s+/;a._eventsApi=function(t,i,n,r){if(!n)return!1;var o={};if("object"==typeof n){for(var s in n){var a=t[i].apply(t,[s,n[s]].concat(r));h.test(s)?e.extend(o,a):o[s]=a}return o}if(h.test(n)){for(var c=n.split(h),l=0,u=c.length;u>l;l++)o[c[l]]=t[i].apply(t,[c[l]].concat(r));return o}return!1},a._callHandler=function(e,t,i){var n=i[0],r=i[1],o=i[2];switch(i.length){case 0:return e.call(t);case 1:return e.call(t,n);case 2:return e.call(t,n,r);case 3:return e.call(t,n,r,o);default:return e.apply(t,i)}};var c={};e.extend(a,{log:function(t,i){var n=e.rest(arguments,2);console.log("["+t+'] "'+i+'"',n)},tuneIn:function(e){var t=a.channel(e);return t._tunedIn=!0,t.on("all",r(e)),this},tuneOut:function(e){var t=a.channel(e);return t._tunedIn=!1,t.off("all",r(e)),delete c[e],this}}),a.Requests={request:function(t){var i=e.rest(arguments),n=a._eventsApi(this,"request",t,i);if(n)return n;var r=this.channelName,o=this._requests;if(r&&this._tunedIn&&a.log.apply(this,[r,t].concat(i)),o&&(o[t]||o["default"])){var s=o[t]||o["default"];return i=o[t]?i:arguments,a._callHandler(s.callback,s.context,i)}a.debugLog("An unhandled request was fired",t,r)},reply:function(e,t,i){return a._eventsApi(this,"reply",e,[t,i])?this:(this._requests||(this._requests={}),this._requests[e]&&a.debugLog("A request was overwritten",e,this.channelName),this._requests[e]={callback:o(t),context:i||this},this)},replyOnce:function(t,i,n){if(a._eventsApi(this,"replyOnce",t,[i,n]))return this;var r=this,s=e.once(function(){return r.stopReplying(t),o(i).apply(this,arguments)});return this.reply(t,s,n)},stopReplying:function(e,t,i){return a._eventsApi(this,"stopReplying",e)?this:(e||t||i?n(this._requests,e,t,i)||a.debugLog("Attempted to remove the unregistered request",e,this.channelName):delete this._requests,this)}},a._channels={},a.channel=function(e){if(!e)throw new Error("You must provide a name for the channel.");return a._channels[e]?a._channels[e]:a._channels[e]=new a.Channel(e)},a.Channel=function(e){this.channelName=e},e.extend(a.Channel.prototype,t.Events,a.Requests,{reset:function(){return this.off(),this.stopListening(),this.stopReplying(),this}});var l,u,d=[t.Events,a.Commands,a.Requests];e.each(d,function(t){e.each(t,function(t,i){a[i]=function(t){return u=e.rest(arguments),l=this.channel(t),l[i].apply(l,u)}})}),a.reset=function(t){var i=t?[this._channels[t]]:this._channels;e.invoke(i,"reset")};var f=a;return f})},{"./../../../assets/js/src/admin/vendor/backbone-shim.js":29,"./../../../assets/js/src/admin/vendor/underscore-shim.js":33}],37:[function(t,i,n){!function(i){"function"==typeof e&&e.amd?e(["underscore","backbone","exports"],i):"object"==typeof n?i(t("./../../assets/js/src/admin/vendor/underscore-shim.js"),t("./../../assets/js/src/admin/vendor/backbone-shim.js"),n):i(_,Backbone,{})}(function(e,t,i){t.Stickit=i,i._handlers=[],i.addHandler=function(t){t=e.map(e.flatten([t]),function(t){return e.defaults({},t,{updateModel:!0,updateView:!0,updateMethod:"text"})}),this._handlers=this._handlers.concat(t)},i.ViewMixin={_modelBindings:null,unstickit:function(t,i){if(e.isObject(i))return void e.each(i,function(e,i){this.unstickit(t,i)},this);var n=[],r=[];this._modelBindings=e.reject(this._modelBindings,function(e){return t&&e.model!==t||i&&e.config.selector!=i?void 0:(e.model.off(e.event,e.fn),r.push(e.config._destroy),n.push(e.model),!0)}),e.invoke(e.uniq(n),"trigger","stickit:unstuck",this.cid),e.each(e.uniq(r),function(e){e.call(this)},this),this.$el.off(".stickit"+(t?"."+t.cid:""),i)},stickit:function(t,i){var n=t||this.model,r=i||e.result(this,"bindings")||{};this._modelBindings||(this._modelBindings=[]),this.addBinding(n,r);var o=this.remove;return o.stickitWrapped||(this.remove=function(){var e=this;return this.unstickit(),o&&(e=o.apply(this,arguments)),e}),this.remove.stickitWrapped=!0,this},addBinding:function(t,i,r){var p=t||this.model,m=".stickit."+p.cid;if(r=r||{},e.isObject(i)){var v=i;return void e.each(v,function(e,t){this.addBinding(p,t,e)},this)}var y=":el"===i?this.$el:this.$(i);if(this.unstickit(p,i),y.length){e.isString(r)&&(r={observe:r}),e.isFunction(r.observe)&&(r.observe=r.observe.call(this));var _=l(y,r),b=_.observe;_.selector=i,_.view=this;var w=_.bindId=e.uniqueId(),C=e.extend({stickitChange:_},_.setOptions);if(_._destroy=function(){o.call(this,_.destroy,y,p,_)},u(y,_,p,b),f(y,_,p,b),d(y,_,p,b),b){e.each(_.events,function(t){var r=t+m,a=function(e){var t=o.call(this,_.getVal,y,e,_,n.call(arguments,1)),i=s(_.updateModel,t,e,_);i&&h(p,b,t,C,_)},c=":el"===i?"":i;this.$el.on(r,c,e.bind(a,this))},this),e.each(e.flatten([b]),function(e){a(p,"change:"+e,_,function(e,t,i){var n=i&&i.stickitChange&&i.stickitChange.bindId;if(n!==w){var r=c(p,b,_);g(y,_,r,p)}})});var x=c(p,b,_);g(y,_,x,p,!0)}o.call(this,_.initialize,y,p,_)}}},e.extend(t.View.prototype,i.ViewMixin);var n=[].slice,r=function(t,i){var n=(i||"").split("."),r=e.reduce(n,function(e,t){return e[t]},t);return null==r?t:r},o=function(t){return t=e.isString(t)?r(this,t):t,t?t.apply(this,n.call(arguments,1)):void 0},s=function(t,i,n){if(e.isBoolean(t))return t;if(e.isFunction(t)||e.isString(t)){var r=e.last(arguments).view;return o.apply(r,arguments)}return!1},a=function(e,t,i,n){var r=i.view;e.on(t,n,r),r._modelBindings.push({model:e,event:t,fn:n,config:i})},h=function(t,i,n,r,s){var a={},h=s.view;s.onSet&&(n=o.call(h,s.onSet,n,s)),s.set?o.call(h,s.set,i,n,r,s):(a[i]=n,e.isArray(i)&&e.isArray(n)&&(a=e.reduce(i,function(t,i,r){return t[i]=e.has(n,r)?n[r]:null,t},{})),t.set(a,r))},c=function(t,i,n){var r=n.view,s=function(e){return t[n.escape?"escape":"get"](e)},a=function(e){return null==e?"":e},h=e.isArray(i)?e.map(i,s):s(i);return n.onGet&&(h=o.call(r,n.onGet,h,n)),e.isArray(h)?e.map(h,a):a(h)},l=i.getConfiguration=function(t,n){var r=[{updateModel:!1,updateMethod:"text",update:function(e,t,i,n){e[n.updateMethod]&&e[n.updateMethod](t)},getVal:function(e,t,i){return e[i.updateMethod]()}}];r=r.concat(e.filter(i._handlers,function(e){return t.is(e.selector)})),r.push(n);var o=e.extend.apply(e,r);return e.has(o,"updateView")||(o.updateView=!o.visible),o},u=function(t,i,n,r){var o=["autofocus","autoplay","async","checked","controls","defer","disabled","hidden","indeterminate","loop","multiple","open","readonly","required","scoped","selected"],s=i.view;e.each(i.attributes||[],function(h){h=e.clone(h),h.view=s;var l="",u=h.observe||(h.observe=r),d=function(){var i=e.contains(o,h.name)?"prop":"attr",r=c(n,u,h);"class"===h.name?(t.removeClass(l).addClass(r),l=r):t[i](h.name,r)};e.each(e.flatten([u]),function(e){a(n,"change:"+e,i,d)}),d()})},d=function(t,i,n,r){e.each(i.classes||[],function(r,o){e.isString(r)&&(r={observe:r}),r.view=i.view;var s=r.observe,h=function(){var e=c(n,s,r);t.toggleClass(o,!!e)};e.each(e.flatten([s]),function(e){a(n,"change:"+e,i,h)}),h()})},f=function(t,i,n,r){if(null!=i.visible){var s=i.view,h=function(){var a=i.visible,h=i.visibleFn,l=c(n,r,i),u=!!l;(e.isFunction(a)||e.isString(a))&&(u=!!o.call(s,a,l,i)),h?o.call(s,h,t,u,i):t.toggle(u)};e.each(e.flatten([r]),function(e){a(n,"change:"+e,i,h)}),h()}},g=function(e,t,i,n,r){var a=t.view;s(t.updateView,i,t)&&(o.call(a,t.update,e,i,n,t),r||o.call(a,t.afterUpdate,e,i,t))};return i.addHandler([{selector:"[contenteditable]",updateMethod:"html",events:["input","change"]},{selector:"input",events:["propertychange","input","change"],update:function(e,t){e.val(t)},getVal:function(e){return e.val()}},{selector:"textarea",events:["propertychange","input","change"],update:function(e,t){e.val(t)},getVal:function(e){return e.val()}},{selector:'input[type="radio"]',events:["change"],update:function(e,t){e.filter('[value="'+t+'"]').prop("checked",!0)},getVal:function(e){return e.filter(":checked").val()}},{selector:'input[type="checkbox"]',events:["change"],update:function(i,n,r,o){if(i.length>1)n||(n=[]),i.each(function(i,r){var o=t.$(r),s=e.contains(n,o.val());o.prop("checked",s)});else{var s=e.isBoolean(n)?n:n===i.val();i.prop("checked",s)}},getVal:function(i){var n;if(i.length>1)n=e.reduce(i,function(e,i){var n=t.$(i);return n.prop("checked")&&e.push(n.val()),e},[]);else{n=i.prop("checked");var r=i.val();"on"!==r&&null!=r&&(n=n?i.val():null)}return n}},{selector:"select",events:["change"],update:function(i,n,s,a){var h,l=a.selectOptions,u=l&&l.collection||void 0,d=i.prop("multiple");if(!l){l={};var f=function(e){return e.map(function(e,i){var n=t.$(i).data("stickit-bind-val");return{value:void 0!==n?n:i.value,label:i.text}}).get()};i.find("optgroup").length?(u={opt_labels:[]},i.find("> option").length&&(u.opt_labels.push(void 0),e.each(i.find("> option"),function(e){u[void 0]=f(t.$(e))})),e.each(i.find("optgroup"),function(e){var i=t.$(e).attr("label");u.opt_labels.push(i),u[i]=f(t.$(e).find("option"))})):u=f(i.find("option"))}l.valuePath=l.valuePath||"value",l.labelPath=l.labelPath||"label",l.disabledPath=l.disabledPath||"disabled";var g=function(i,n,o){e.each(i,function(i){var s,a,h,c=t.$("<option/>"),u=i,f=function(t,i,n){c.text(t),u=i,c.data("stickit-bind-val",u),e.isArray(u)||e.isObject(u)||c.val(u),n===!0&&c.prop("disabled","disabled")};"__default__"===i?(s=o.label,a=o.value,h=o.disabled):(s=r(i,l.labelPath),a=r(i,l.valuePath),h=r(i,l.disabledPath)),f(s,a,h);var g=function(){return d||null==u||null==o||u!==o?e.isObject(o)&&e.isEqual(u,o)?!0:!1:!0};g()?c.prop("selected",!0):d&&e.isArray(o)&&e.each(o,function(t){e.isObject(t)&&(t=r(t,l.valuePath)),(t===u||e.isObject(t)&&e.isEqual(u,t))&&c.prop("selected",!0)}),n.append(c)})};if(i.find("*").remove(),e.isString(u)){var p=window;0===u.indexOf("this.")&&(p=this),u=u.replace(/^[a-z]*\.(.+)$/,"$1"),h=r(p,u)}else h=e.isFunction(u)?o.call(this,u,i,a):u;if(h instanceof t.Collection){var m=h,v=function(){var e=c(s,a.observe,a);o.call(this,a.update,i,e,s,a)},y=function(){m.off("add remove reset sort",v)},_=function(){y(),m.off("stickit:selectRefresh"),s.off("stickit:selectRefresh")};m.trigger("stickit:selectRefresh"),m.once("stickit:selectRefresh",y,this),m.on("add remove reset sort",v,this),s.trigger("stickit:selectRefresh"),s.once("stickit:selectRefresh",function(){s.off("stickit:unstuck",_)}),s.once("stickit:unstuck",_,this),h=h.toJSON()}if(l.defaultOption){var b=e.isFunction(l.defaultOption)?l.defaultOption.call(this,i,a):l.defaultOption;g(["__default__"],i,b)}if(e.isArray(h))g(h,i,n);else if(h.opt_labels)e.each(h.opt_labels,function(e){var r=t.$("<optgroup/>").attr("label",e);g(h[e],r,n),i.append(r)});else{var w,C=[];for(var x in h)w={},w[l.valuePath]=x,w[l.labelPath]=h[x],C.push(w);C=e.sortBy(C,l.comparator||l.labelPath),g(C,i,n)}},getVal:function(i){var n=i.find("option:selected");return i.prop("multiple")?e.map(n,function(e){return t.$(e).data("stickit-bind-val")}):n.data("stickit-bind-val")}}]),i})},{"./../../assets/js/src/admin/vendor/backbone-shim.js":29,"./../../assets/js/src/admin/vendor/underscore-shim.js":33}],38:[function(e,t,i){},{}],39:[function(t,i,n){("undefined"!=typeof i&&function(e){i.exports=e()}||"function"==typeof e&&function(t){e("underscoreDeepExtend",t)}||function(e){window.underscoreDeepExtend=e()})(function(){return function(e){return function(t){var i=/#{\s*?_\s*?}/,n=Array.prototype.slice,r=Object.prototype.hasOwnProperty;return e.each(n.call(arguments,1),function(n){for(var o in n)if(r.call(n,o))if(e.isUndefined(t[o])||e.isFunction(t[o])||e.isNull(n[o])||e.isDate(n[o]))t[o]=n[o];else if(e.isString(n[o])&&i.test(n[o]))e.isString(t[o])&&(t[o]=n[o].replace(i,t[o]));else if(e.isArray(t[o])||e.isArray(n[o])){if(!e.isArray(t[o])||!e.isArray(n[o]))throw"Error: Trying to combine an array with a non-array ("+o+")";t[o]=e.reject(e.deepExtend(t[o],n[o]),function(t){return e.isNull(t)})}else if(e.isObject(t[o])||e.isObject(n[o])){if(!e.isObject(t[o])||!e.isObject(n[o]))throw"Error: Trying to combine an object with a non-object ("+o+")";t[o]=e.deepExtend(t[o],n[o])}else t[o]=n[o]}),t}}})},{}]},{},[12])(12)});
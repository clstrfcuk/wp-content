function EnviraGalleryImagesUpdate(e){EnviraGalleryImages.reset();var t="ul#envira-gallery-output li.envira-gallery-image"+(e?".selected":"");jQuery(t).each(function(){var e=jQuery.parseJSON(jQuery(this).attr("data-envira-gallery-image-model"));e.alt=EnviraGalleryStripslashes(e.alt),EnviraGalleryImages.add(new EnviraGalleryImage(e))})}function EnviraGalleryStripslashes(e){return(e+"").replace(/\\(.?)/g,function(e,t){switch(t){case"\\":return"\\";case"0":return"\0";case"":return"";default:return t}})}jQuery(document).ready(function($){$('select[name="_envira_gallery[image_size]"]').on("change",function(){"envira_gallery_random"===$(this).val()?$("tr#envira-config-image-sizes-random-box").show():$("tr#envira-config-image-sizes-random-box").hide()}),$('select[name="_envira_gallery[image_size]"]').trigger("change")}),function($){$(function(){var e=!1;"default"===$('input[name="_envira_gallery[type]"]:checked').val()?$("#envira-gallery-preview").hide():$("#envira-gallery-preview").show(),$(document).on("enviraGalleryType enviraGalleryPreview",function(){var t=$('input[name="_envira_gallery[type]"]:checked').val(),a=$("#envira-gallery-preview .spinner"),i=$("#envira-gallery-preview-main");return"default"===t?void $(i).hide():void(e||(e=!0,$(i).html(""),$.ajax({type:"post",url:envira_gallery_metabox.ajax,dataType:"json",data:{action:"envira_gallery_change_preview",post_id:envira_gallery_metabox.id,type:t,data:$("form#post").serializeArray(),nonce:envira_gallery_metabox.preview_nonce},success:function(t){$(i).html(t),$(a).hide(),e=!1},error:function(t,n){$(i).html('<div class="error"><p>'+t.responseText+"</p></div>"),$(a).hide(),e=!1}})))})})}(jQuery),function($){$(function(){$("#envira-gallery-types-nav").on("click","li",function(e){$('input[name="_envira_gallery[type]"]',$(this)).prop("checked",!0).trigger("change")}),$(document).on("change",'input[name="_envira_gallery[type]"]:radio',function(e){var t=$(this).val(),a=$("#envira-tabs #envira-tab-images .spinner"),i=$("#envira-tabs #envira-tab-images #envira-gallery-main");$(a).css("visibility","visible"),$("li",$(this).closest("#envira-gallery-types-nav")).removeClass("envira-active"),$(this).closest("li").addClass("envira-active"),$("a",$("#envira-tabs-nav li").first()).trigger("click"),$(i).html(""),$.ajax({type:"post",url:envira_gallery_metabox.ajax,dataType:"json",data:{action:"envira_gallery_change_type",post_id:envira_gallery_metabox.id,type:t,nonce:envira_gallery_metabox.change_nonce},success:function(e){$(i).html(e.html),$(document).trigger("enviraGalleryType",e),$(a).hide()},error:function(e,t){$(i).html('<div class="error"><p>'+e.responseText+"</p></div>"),$(a).hide()}})})})}(jQuery);var envira_video_link="p.envira-intro a.envira-video",envira_close_video_link="a.envira-video-close";jQuery(document).ready(function($){$(document).on("click",envira_video_link,function(e){e.preventDefault();var t=$(this).attr("href");t.search("autoplay=1")===-1&&(t+=t.search("rel=")===-1?"?rel=0&autoplay=1":"&autoplay=1"),$("div.envira-video-help").remove();var a=$(this).closest("p.envira-intro");$(a).append('<div class="envira-video-help"><iframe src="'+t+'" /><a href="#" class="envira-video-close dashicons dashicons-no"></a></div>')}),$(document).on("click",envira_close_video_link,function(e){e.preventDefault(),$(this).closest(".envira-video-help").remove()})});var EnviraGalleryBulkEditImageView=wp.Backbone.View.extend({tagName:"li",className:"attachment",template:wp.template("envira-meta-bulk-editor-image"),initialize:function(e){this.model=e.model},render:function(){return this.$el.html(this.template(this.model.attributes)),this}}),EnviraGalleryBulkEditView=wp.Backbone.View.extend({tagName:"div",className:"edit-attachment-frame mode-select hide-menu hide-router",template:wp.template("envira-meta-bulk-editor"),events:{"keyup input":"updateItem","keyup textarea":"updateItem","change input":"updateItem","change textarea":"updateItem","blur textarea":"updateItem","change select":"updateItem","click .actions a.envira-gallery-meta-submit":"saveItem","keyup input#link-search":"searchLinks","click div.query-results li":"insertLink","click button.media-file":"insertMediaFileLink","click button.attachment-page":"insertAttachmentPageLink"},initialize:function(e){this.on("loading",this.loading,this),this.on("loaded",this.loaded,this),this.is_loading=!1,this.collection=e.collection,this.child_views=e.child_views,this.model=new EnviraGalleryImage},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.collection.forEach(function(e){var t=new EnviraGalleryBulkEditImageView({model:e});this.$el.find("ul.attachments").append(t.render().el)},this),this.child_views.length>0&&this.child_views.forEach(function(e){var t=new e({model:this.model});this.$el.find("div.envira-addons").append(t.render().el)},this),setTimeout(function(){quicktags({id:"caption",buttons:"strong,em,link,ul,ol,li,close"}),QTags._buttonsInit()},500),wpLink.init,this},renderError:function(e){var t={};t.error=e;var a=new wp.media.view.EnviraGalleryError({model:t});return a.render().el},loading:function(){this.is_loading=!0,this.$el.find(".spinner").css("visibility","visible")},loaded:function(e){this.is_loading=!1,this.$el.find(".spinner").css("visibility","hidden"),"undefined"!=typeof e&&this.$el.find("ul.attachments").before(this.renderError(e))},updateItem:function(e){""!==e.target.name&&("checkbox"===e.target.type?value=e.target.checked?1:0:value=e.target.value,this.model.set(e.target.name,value))},saveItem:function(e){e.preventDefault(),this.trigger("loading");var t=[];this.collection.forEach(function(e){t.push(e.id)},this),wp.media.ajax("envira_gallery_save_bulk_meta",{context:this,data:{nonce:envira_gallery_metabox.save_nonce,post_id:envira_gallery_metabox.id,meta:this.model.attributes,image_ids:t},success:function(e){this.collection.forEach(function(e){for(var t in this.model.attributes)value=this.model.attributes[t],value.length>0&&e.set(t,value);var a=JSON.stringify(e.attributes);jQuery("ul#envira-gallery-output li#"+e.get("id")).attr("data-envira-gallery-image-model",a),jQuery("ul#envira-gallery-output li#"+e.get("id")+" div.title").text(e.get("title"))},this),jQuery("nav.envira-tab-options input[type=checkbox]").prop("checked",!1).trigger("change"),this.trigger("loaded loaded:success"),EnviraGalleryModalWindow.close()},error:function(e){this.trigger("loaded loaded:error",e)}})},insertMediaFileLink:function(e){this.trigger("loading"),this.model.set("link",response.media_link),this.trigger("loaded loaded:success"),this.render()},insertAttachmentPageLink:function(e){this.trigger("loading"),this.model.set("link",response.media_link),this.trigger("loaded loaded:success"),this.render()}});jQuery(document).ready(function($){$("#envira-gallery-main").on("click","a.envira-gallery-images-edit",function(e){e.preventDefault(),EnviraGalleryImagesUpdate(!0),EnviraGalleryModalWindow.content(new EnviraGalleryBulkEditView({collection:EnviraGalleryImages,child_views:EnviraGalleryChildViews})),EnviraGalleryModalWindow.open()})});var EnviraGalleryImage=Backbone.Model.extend({defaults:{id:"",title:"",caption:"",alt:"",link:""}}),EnviraGalleryImages=new Backbone.Collection;if("undefined"==typeof EnviraGalleryModalWindow)var EnviraGalleryModalWindow=new wp.media.view.Modal({controller:{trigger:function(){}}});var EnviraGalleryEditView=wp.Backbone.View.extend({tagName:"div",className:"edit-attachment-frame mode-select hide-menu hide-router",template:wp.template("envira-meta-editor"),events:{"click .edit-media-header .left":"loadPreviousItem","click .edit-media-header .right":"loadNextItem","keyup input":"updateItem","keyup textarea":"updateItem","change input":"updateItem","change textarea":"updateItem","blur textarea":"updateItem","change select":"updateItem","click .actions a.envira-gallery-meta-submit":"saveItem","keyup input#link-search":"searchLinks","click div.query-results li":"insertLink","click button.media-file":"insertMediaFileLink","click button.attachment-page":"insertAttachmentPageLink"},initialize:function(e){console.log("hello world"),this.on("loading",this.loading,this),this.on("loaded",this.loaded,this),this.is_loading=!1,this.collection=e.collection,this.child_views=e.child_views,this.attachment_id=e.attachment_id,this.attachment_index=0,this.search_timer="";var t=0;this.collection.each(function(e){return e.get("id")==this.attachment_id?(this.model=e,this.attachment_index=t,!1):void t++},this)},render:function(){return console.log("hello world"),this.$el.html(this.template(this.model.attributes)),this.child_views.length>0&&this.child_views.forEach(function(e){var t=new e({model:this.model});this.$el.find("div.envira-addons").append(t.render().el)},this),this.$el.find("textarea[name=caption]").val(this.model.get("caption")),setTimeout(function(){quicktags({id:"caption",buttons:"strong,em,link,ul,ol,li,close"}),QTags._buttonsInit()},500),wpLink.init,0==this.attachment_index&&this.$el.find("button.left").addClass("disabled"),this.attachment_index==this.collection.length-1&&this.$el.find("button.right").addClass("disabled"),jQuery(document).trigger("enviraRenderMeta"),this},renderError:function(e){var t={};t.error=e;var a=new wp.media.view.EnviraGalleryError({model:t});return a.render().el},loading:function(){this.is_loading=!0,this.$el.find(".spinner").css("visibility","visible")},loaded:function(e){this.is_loading=!1,this.$el.find(".spinner").css("visibility","hidden"),"undefined"!=typeof e&&this.$el.find("div.media-toolbar").after(this.renderError(e))},loadPreviousItem:function(){this.attachment_index--,this.model=this.collection.at(this.attachment_index),this.attachment_id=this.model.get("id"),this.render()},loadNextItem:function(){this.attachment_index++,this.model=this.collection.at(this.attachment_index),this.attachment_id=this.model.get("id"),this.render()},updateItem:function(e){""!=e.target.name&&("checkbox"==e.target.type?value=e.target.checked?e.target.value:0:value=e.target.value,this.model.set(e.target.name,value))},saveItem:function(e){e.preventDefault(),this.trigger("loading"),wp.media.ajax("envira_gallery_save_meta",{context:this,data:{nonce:envira_gallery_metabox.save_nonce,post_id:envira_gallery_metabox.id,attach_id:this.model.get("id"),meta:this.model.attributes},success:function(e){this.trigger("loaded loaded:success");var t=JSON.stringify(this.model.attributes),a=jQuery("ul#envira-gallery-output li#"+this.model.get("id"));jQuery(a).attr("data-envira-gallery-image-model",t),jQuery("div.meta div.title span",a).text(this.model.get("title")),jQuery("div.meta div.title a.hint",a).attr("title",this.model.get("title")),this.model.get("title").length>20?jQuery("div.meta div.title a.hint",a).removeClass("hidden"):jQuery("div.meta div.title a.hint",a).addClass("hidden");var i=this.$el.find(".saved");i.fadeIn(),setTimeout(function(){i.fadeOut()},1500)},error:function(e){this.trigger("loaded loaded:error",e)}})},searchLinks:function(e){},insertLink:function(e){},insertMediaFileLink:function(e){this.trigger("loading"),wp.media.ajax("envira_gallery_get_attachment_links",{context:this,data:{nonce:envira_gallery_metabox.save_nonce,attachment_id:this.model.get("id")},success:function(e){this.model.set("link",e.media_link),this.trigger("loaded loaded:success"),this.render()},error:function(e){this.trigger("loaded loaded:error",e)}})},insertAttachmentPageLink:function(e){this.trigger("loading"),wp.media.ajax("envira_gallery_get_attachment_links",{context:this,data:{nonce:envira_gallery_metabox.save_nonce,attachment_id:this.model.get("id")},success:function(e){this.model.set("link",e.attachment_page),this.trigger("loaded loaded:success"),this.render()},error:function(e){this.trigger("loaded loaded:error",e)}})}}),EnviraGalleryChildViews=[];jQuery(document).ready(function($){$("a.envira-media-library").on("click",function(e){return e.preventDefault(),wp.media.frames.envira?void wp.media.frames.envira.open():(wp.media.frames.envira=wp.media({frame:"post",title:wp.media.view.l10n.insertIntoPost,button:{text:wp.media.view.l10n.insertIntoPost},multiple:!0}),wp.media.frames.envira.on("open",function(){var e=wp.media.frames.envira.state().get("selection");$("ul#envira-gallery-output li").each(function(){var t=wp.media.attachment($(this).attr("id"));void 0!=e&&e.add(t?[t]:[])})}),wp.media.frames.envira.on("insert",function(e){var t=wp.media.frames.envira.state(),a=[];e.each(function(e){var i=t.display(e).toJSON();switch(i.link){case"none":e.set("link",e.get("url"));break;case"file":e.set("link",e.get("url"));break;case"post":break;case"custom":e.set("link",i.linkUrl)}a.push(e.toJSON())},this),$.post(envira_gallery_metabox.ajax,{action:"envira_gallery_insert_images",nonce:envira_gallery_metabox.insert_nonce,post_id:envira_gallery_metabox.id,images:JSON.stringify(a)},function(e){e&&e.success&&($("#envira-gallery-output").html(e.success),$(document).trigger("enviraInsert"),EnviraGalleryImagesUpdate(!1))},"json")}),void wp.media.frames.envira.open())})});var envira_manage=window.envira_manage||{};!function($,e,t,a,i){"use strict";var n="#envira-gallery-output",r=$(n+" li").length,l=!1,s=!1;e.envira_manage=a={init:function(){this.select(),this.select_all(),this.clear_selected(),this.sortable(),this.display_toggle(),this.delete_item(),this.bulk_delete(),this.edit_meta(),this.toggle_status(),this.tooltip(),$(t).on("keyup keydown",function(e){l=e.shiftKey}),$(t).trigger("envriaAdminInit")},toggle_status:function(){$(n).on("click.enviraStatus",".envira-item-status",function(e){e.preventDefault(),e.stopPropagation();var a=$(this),n=a.data("status"),r=a.hasClass("list-status")?a.parent().parent().parent():a.parent(),l=r.find(".envira-item-status.list-status"),s=r.find(".envira-item-status.grid-status"),o=a.data("id"),d=s.find("span.dashicons"),c=l.find("span"),v="active"===n?"pending":"active",u={url:i.ajax,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"envira_change_image_status",post_id:i.id,gallery_id:o,status:v,nonce:i.save_nonce},success:function(e){e.success&&("active"===v?(s.removeClass("envira-draft-item").addClass("envira-active-item"),l.removeClass("envira-draft-item").addClass("envira-active-item"),d.removeClass("dashicons-hidden").addClass("dashicons-visibility"),c.text(i.active),s.attr("data-envira-tooltip",i.active),l.data("status","active"),s.data("status","active")):(s.removeClass("envira-active-item").addClass("envira-draft-item"),l.removeClass("envira-active-item").addClass("envira-draft-item"),d.removeClass("dashicons-visibility").addClass("dashicons-hidden"),c.text(i.draft),l.data("status","pending"),s.data("status","pending"),s.attr("data-envira-tooltip",i.draft)),$(t).trigger("envriaChangeStatus "))},error:function(e,t,a){}};$.ajax(u)})},tooltip:function(){$("[data-envira-tooltip]").on("mouseover",function(e){e.preventDefault();var t=$(this),a=t.data("envira-tooltip")})},select_all:function(){$(t).on("change","nav.envira-tab-options input",function(e){if($(this).prop("checked")){$("li",$(n)).addClass("selected"),$("nav.envira-select-options").fadeIn();var a=$(n+" li.selected").length;$(".select-all").text(i.selected),$(".envira-count").text(a.toString()),$(".envira-clear-selected").fadeIn()}else $("li",$(n)).removeClass("selected"),$("nav.envira-select-options").fadeOut(),r=$(n+" li").length,$(".select-all").text(i.select_all),$(".envira-count").text(r.toString()),$(".envira-clear-selected").fadeOut();$(t).trigger("enviraSelectAll")})},sort_images:function(){$(t).on("change","#envira-config-image-sort",function(){var e=$(this),t=e.val(),r="",l={url:i.ajax,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"envira_sort_publish",post_id:i.id,order:t,direction:r,nonce:i.save_nonce},success:function(e){console.log(t),console.log(r),console.log(e),e&&($(n).html(e.data),EnviraGalleryImagesUpdate(!1),"manual"===t?$(n).attr("data-sortable","1"):$(n).attr("data-sortable","0"),a.sortable())},error:function(e,t,a){}};$.ajax(l)})},sortable:function(){$(n).sortable({containment:n,items:"li",cursor:"move",forcePlaceholderSize:!0,placeholder:"dropzone",helper:function(e,t){t.hasClass("selected")||t.addClass("selected").siblings().removeClass("selected");var a=t.parent().children(".selected").clone();t.data("multidrag",a).siblings(".selected").remove();var i=$("<li/>");return i.append(a)},stop:function(e,t){var a=t.item.data("multidrag");t.item.after(a).remove(),$.ajax({url:i.ajax,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"envira_gallery_sort_images",order:$(n).sortable("toArray").toString(),post_id:i.id,nonce:i.sort},success:function(e){EnviraGalleryImagesUpdate(!1)},error:function(e,t,a){$(n).before('<div class="error"><p>'+t.responseText+"</p></div>")}})}})},select:function(){$(t).on("click","ul#envira-gallery-output li.envira-gallery-image > img, li.envira-gallery-image > div, li.envira-gallery-image > a.check",function(e){e.preventDefault();var t=$(this),a=t.parent(),o="";if(a.hasClass("selected"))a.removeClass("selected"),o=$(n+" li.selected").length,s=!1,0!==o?($(".select-all").text(i.selected),$(".envira-count").text(o.toString()),$(".envira-clear-selected").fadeIn()):(r=$(n+" li").length,$(".select-all").text(i.select_all),$(".envira-count").text(r.toString()),$(".envira-clear-selected").fadeOut());else{if(l&&s!==!1){var d=$("ul#envira-gallery-output li").index($(s)),c=$("ul#envira-gallery-output li").index($(a)),v=0;if(d<c)for(v=d;v<=c;v++)$("ul#envira-gallery-output li:eq( "+v+")").addClass("selected");else for(v=c;v<=d;v++)$("ul#envira-gallery-output li:eq( "+v+")").addClass("selected")}$(a).addClass("selected"),s=$(a),o=$(n+" li.selected").length,$(".envira-clear-selected").fadeIn(),$(".select-all").text(i.selected),$(".envira-count").text(o.toString())}$("ul#envira-gallery-output > li.selected").length>0?$("nav.envira-select-options").fadeIn():$("nav.envira-select-options").fadeOut()})},clear_selected:function(){$(".envira-clear-selected").on("click",function(e){e.preventDefault(),$(n+" li.selected").removeClass("selected"),r=$(n+" li").length,console.log(r),$(".select-all").text(i.select_all),$(".envira-count").text(r.toString()),$(".envira-select-all").prop("checked",!1),$("nav.envira-select-options").fadeOut(),$(this).fadeOut(),$(t).trigger("enviraClearSelected")})},display_toggle:function(){$(t).on("click","nav.envira-tab-options a",function(e){e.preventDefault();var a=$(this).closest(".envira-tab-options"),n=$(this).data("view"),r=$(this).data("view-style");$(n).hasClass(r)||($(n).removeClass("list").removeClass("grid").addClass(r),$("a",a).removeClass("selected"),$(this).addClass("selected"),$.ajax({url:i.ajax,type:"post",dataType:"json",data:{action:"envira_gallery_set_user_setting",name:"envira_gallery_image_view",value:r,nonce:i.set_user_setting_nonce},success:function(e){$(t).trigger("enviraDisplayToggle")},error:function(e,t,a){$(envira_gallery_output).before('<div class="error"><p>'+t.responseText+"</p></div>")}}))})},chosen:function(){$(".envira-chosen").each(function(){var e=$(this).data("envira-chosen-options");$(this).chosen(e)})},update_count:function(){r=$(n+" li").length,$(".envira-count").text(r.toString()),r>0&&($("#envira-empty-itemr").fadeOut().addClass("envira-hidden"),$(".envira-item-header").removeClass("envira-hidden").fadeIn(),$(".envira-bulk-actions").fadeOut())},delete_item:function(){$(t).on("click","#envira-gallery-main .envira-gallery-remove-image",function(e){e.preventDefault();var t=confirm(i.remove);if(t){var n=$(this).parent().attr("id");$.ajax({url:i.ajax,type:"post",dataType:"json",data:{action:"envira_gallery_remove_image",attachment_id:n,post_id:i.id,nonce:i.remove_nonce},success:function(e){$("#"+n).fadeOut("normal",function(){$(this).remove(),$(".envira-gallery-load-library").attr("data-envira-gallery-offset",0).addClass("has-search").trigger("click"),EnviraGalleryImagesUpdate(!1),a.start_screen()})},error:function(e,t,a){$(envira_gallery_output).before('<div class="error"><p>'+t.responseText+"</p></div>")}})}})},bulk_delete:function(){$(t).on("click","a.envira-gallery-images-delete",function(e){e.preventDefault();var t=confirm(i.remove_multiple);if(!t)return!1;var n=[];$("ul#envira-gallery-output > li.selected").each(function(){n.push($(this).attr("id"))});var r=$(this).parent().attr("id");$.ajax({url:i.ajax,type:"post",dataType:"json",data:{action:"envira_gallery_remove_images",attachment_ids:n,post_id:i.id,nonce:i.remove_nonce},success:function(e){e.success&&($("ul#envira-gallery-output > li.selected").remove(),$("nav.envira-select-options").fadeOut(),$(".envira-gallery-load-library").attr("data-envira-gallery-offset",0).addClass("has-search").trigger("click"),EnviraGalleryImagesUpdate(!1),a.start_screen())},error:function(e,t,a){$(envira_gallery_output).before('<div class="error"><p>'+t.responseText+"</p></div>")}})})},edit_meta:function(){$(t).on("click","#envira-gallery-main a.envira-gallery-modify-image",function(e){console.log("hello world"),e.preventDefault(),EnviraGalleryImagesUpdate(!1);var a=$(this).parent().data("envira-gallery-image");EnviraGalleryModalWindow.content(new EnviraGalleryEditView({collection:EnviraGalleryImages,child_views:EnviraGalleryChildViews,attachment_id:a})),EnviraGalleryModalWindow.open(),$(t).trigger("enviraEditOpen")})},start_screen:function(){r=$(n+" li").length,0===r?($("nav.envira-select-options").fadeOut(),$(".envira-content-images").fadeOut().addClass("envira-hidden"),$("#envira-empty-gallery").removeClass("envira-hidden").fadeIn()):($("#envira-empty-gallery").fadeOut().addClass("envira-hidden"),$(".envira-content-images").removeClass("envira-hidden").fadeIn())}},$(function(){a.init()}),$(t).on("enviraGalleryType",function(){a.init()}),$(t).on("enviraInsert",function(){a.start_screen(),a.update_count()})}(jQuery,window,document,envira_manage,envira_gallery_metabox),jQuery(document).ready(function($){$("#envira-gallery-main").on("click","a.envira-gallery-images-move",function(e){e.preventDefault();var t=$(this).data("action");EnviraGalleryModalWindow.content(new EnviraGallerySelectionView({action:t,multiple:!1,sidebar_view:"envira-meta-move-media-sidebar",modal_title:envira_gallery_metabox.move_media_modal_title,insert_button_label:envira_gallery_metabox.move_media_insert_button_label,onInsert:function(){EnviraGalleryImagesUpdate(!0);var e=[];EnviraGalleryImages.forEach(function(t){e.push(t.get("id"))}),this.selection.forEach(function(a){wp.media.ajax("envira_"+t+"_move_media",{context:this,data:{nonce:envira_gallery_metabox.move_media_nonce,from_gallery_id:envira_gallery_metabox.id,to_gallery_id:a.id,image_ids:e},success:function(e){$("ul#envira-gallery-output > li.selected").remove(),$("nav.envira-select-options").fadeOut(),EnviraGalleryImagesUpdate(!1),EnviraGalleryModalWindow.close()},error:function(e){alert(e)}})})}})),EnviraGalleryModalWindow.open()})}),function($){$(function(){if("undefined"!=typeof uploader){$("input#plupload-browse-button").val(envira_gallery_metabox.uploader_files_computer);var e=$("#envira-gallery .envira-progress-bar"),t=$("#envira-gallery .envira-progress-bar div.envira-progress-bar-inner"),a=$("#envira-gallery .envira-progress-bar div.envira-progress-bar-status"),i=$("#envira-gallery-output"),n=$("#envira-gallery-upload-error"),r=0;uploader.bind("Init",function(e){$("#drag-drop-area").fadeIn(),$("a.envira-media-library.button").fadeIn()}),uploader.bind("FilesAdded",function(t,i){$(n).html(""),r=i.length,$(".uploading .current",$(a)).text("1"),$(".uploading .total",$(a)).text(r),$(".uploading",$(a)).show(),$(".done",$(a)).hide(),$(e).fadeIn()}),uploader.bind("UploadProgress",function(e,i){$(".uploading .current",$(a)).text(r-e.total.queued+1),$(t).css({width:e.total.percent+"%"})}),uploader.bind("FileUploaded",function(e,t,a){$.post(envira_gallery_metabox.ajax,{action:"envira_gallery_load_image",nonce:envira_gallery_metabox.load_image,id:a.response,post_id:envira_gallery_metabox.id},function(e){switch(envira_gallery_metabox.media_position){case"before":$(i).prepend(e);break;case"after":default:$(i).append(e)}$(document).trigger("enviraInsert"),EnviraGalleryImagesUpdate(!1)},"json")}),uploader.bind("UploadComplete",function(){$(".uploading",$(a)).hide(),$(".done",$(a)).show(),setTimeout(function(){$(e).fadeOut()},1e3)}),uploader.bind("Error",function(e,t){$("#envira-gallery-upload-error").html('<div class="error fade"><p>'+t.file.name+": "+t.message+"</p></div>"),e.refresh()})}})}(jQuery);
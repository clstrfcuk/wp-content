function EnviraGalleryImagesUpdate(e){EnviraGalleryImages.reset();var a="ul#envira-gallery-output li.envira-gallery-image"+(e?".selected":"");jQuery(a).each(function(){var e=jQuery.parseJSON(jQuery(this).attr("data-envira-gallery-image-model"));e.alt=EnviraGalleryStripslashes(e.alt),EnviraGalleryImages.add(new EnviraGalleryImage(e))})}function EnviraGalleryStripslashes(e){return(e+"").replace(/\\(.?)/g,function(e,a){switch(a){case"\\":return"\\";case"0":return"\x00";case"":return"";default:return a}})}jQuery(document).ready(function($){$('select[name="_envira_gallery[image_size]"]').on("change",function(){"envira_gallery_random"===$(this).val()?$("tr#envira-config-image-sizes-random-box").show():$("tr#envira-config-image-sizes-random-box").hide()}),$('select[name="_envira_gallery[image_size]"]').trigger("change"),$("#envira-gallery.postbox").on("dragstart",function(e){return!1})}),function($){$(function(){var e=!1;"default"===$('input[name="_envira_gallery[type]"]:checked').val()?$("#envira-gallery-preview").hide():$("#envira-gallery-preview").show(),$(document).on("enviraGalleryType enviraGalleryPreview",function(){var a=$('input[name="_envira_gallery[type]"]:checked').val(),t=$("#envira-gallery-preview .spinner"),i=$("#envira-gallery-preview-main");return"default"===a?void $(i).hide():void(e||(e=!0,$(i).html(""),$.ajax({type:"post",url:envira_gallery_metabox.ajax,dataType:"json",data:{action:"envira_gallery_change_preview",post_id:envira_gallery_metabox.id,type:a,data:$("form#post").serializeArray(),nonce:envira_gallery_metabox.preview_nonce},success:function(a){$(i).html(a),$(t).hide(),e=!1},error:function(a,n){$(i).html('<div class="error"><p>'+a.responseText+"</p></div>"),$(t).hide(),e=!1}})))})})}(jQuery),function($){$(function(){$("#envira-gallery-types-nav").on("click","li",function(e){$('input[name="_envira_gallery[type]"]',$(this)).prop("checked",!0).trigger("change")}),$(document).on("change",'input[name="_envira_gallery[type]"]:radio',function(e){var a=$(this).val(),t=$("#envira-tabs #envira-tab-images .spinner"),i=$("#envira-tabs #envira-tab-images #envira-gallery-main");$(t).css("visibility","visible"),$("li",$(this).closest("#envira-gallery-types-nav")).removeClass("envira-active"),$(this).closest("li").addClass("envira-active"),$("a",$("#envira-tabs-nav li").first()).trigger("click"),$(i).html(""),$.ajax({type:"post",url:envira_gallery_metabox.ajax,dataType:"json",data:{action:"envira_gallery_change_type",post_id:envira_gallery_metabox.id,type:a,nonce:envira_gallery_metabox.change_nonce},success:function(e){$(i).html(e.html),$(document).trigger("enviraGalleryType",e),$(t).hide()},error:function(e,a){$(i).html('<div class="error"><p>'+e.responseText+"</p></div>"),$(t).hide()}})})})}(jQuery);var envira_video_link="p.envira-intro a.envira-video",envira_close_video_link="a.envira-video-close";jQuery(document).ready(function($){$(document).on("click",envira_video_link,function(e){e.preventDefault();var a=$(this).attr("href");$("div.envira-video-help").remove();var t=$(this).closest("p.envira-intro");$(t).append('<div class="envira-video-help"><iframe src="'+a+'" /><a href="#" class="envira-video-close dashicons dashicons-no"></a></div>')}),$(document).on("click",envira_close_video_link,function(e){e.preventDefault(),$(this).closest(".envira-video-help").remove()})});var EnviraGalleryBulkEditImageView=wp.Backbone.View.extend({tagName:"li",className:"attachment",template:wp.template("envira-meta-bulk-editor-image"),initialize:function(e){this.model=e.model},render:function(){return this.$el.html(this.template(this.model.attributes)),this}}),EnviraGalleryBulkEditView=wp.Backbone.View.extend({tagName:"div",className:"edit-attachment-frame mode-select hide-menu hide-router",template:wp.template("envira-meta-bulk-editor"),events:{"keyup input":"updateItem","keyup textarea":"updateItem","change input":"updateItem","change textarea":"updateItem","blur textarea":"updateItem","change select":"updateItem","click .actions a.envira-gallery-meta-submit":"saveItem","keyup input#link-search":"searchLinks","click div.query-results li":"insertLink","click button.media-file":"insertMediaFileLink","click button.attachment-page":"insertAttachmentPageLink"},initialize:function(e){this.on("loading",this.loading,this),this.on("loaded",this.loaded,this),this.is_loading=!1,this.collection=e.collection,this.child_views=e.child_views,this.model=new EnviraGalleryImage},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.collection.forEach(function(e){var a=new EnviraGalleryBulkEditImageView({model:e});this.$el.find("ul.attachments").append(a.render().el)},this),this.child_views.length>0&&this.child_views.forEach(function(e){var a=new e({model:this.model});this.$el.find("div.envira-addons").append(a.render().el)},this),setTimeout(function(){quicktags({id:"caption",buttons:"strong,em,link,ul,ol,li,close"}),QTags._buttonsInit()},500),this.model.set("status","active"),wpLink.init,this},renderError:function(e){var a={};a.error=e;var t=new wp.media.view.EnviraGalleryError({model:a});return t.render().el},loading:function(){this.is_loading=!0,this.$el.find(".spinner").css("visibility","visible")},loaded:function(e){this.is_loading=!1,this.$el.find(".spinner").css("visibility","hidden"),"undefined"!=typeof e&&this.$el.find("ul.attachments").before(this.renderError(e))},updateItem:function(e){""!==e.target.name&&("checkbox"===e.target.type?value=e.target.checked?1:0:value=e.target.value,this.model.set(e.target.name,value))},saveItem:function(e){e.preventDefault(),this.trigger("loading");var a=[];this.collection.forEach(function(e){a.push(e.id)},this),wp.media.ajax("envira_gallery_save_bulk_meta",{context:this,data:{nonce:envira_gallery_metabox.save_nonce,post_id:envira_gallery_metabox.id,meta:this.model.attributes,image_ids:a},success:function(e){this.collection.forEach(function(a){for(var t in this.model.attributes)value=this.model.attributes[t],value.length>0&&("tags"==t?a.set(t,e[a.get("id")]):a.set(t,value));var i=JSON.stringify(a.attributes),n=jQuery("ul#envira-gallery-output li#"+a.get("id")+" .envira-item-status"),r=n.data("status"),l=n.hasClass("list-status")?n.parent():n.parent(),s=l.find(".envira-item-status.list-status"),o=l.find(".envira-item-status.grid-status"),d=n.data("id"),c=o.find("span.dashicons"),v=s.find("span"),u=a.get("status");jQuery("ul#envira-gallery-output li#"+a.get("id")).attr("data-envira-gallery-image-model",i),jQuery("ul#envira-gallery-output li#"+a.get("id")+" div.title").text(a.get("title")),"active"===u?(o.removeClass("envira-draft-item").addClass("envira-active-item"),s.removeClass("envira-draft-item").addClass("envira-active-item"),c.removeClass("dashicons-hidden").addClass("dashicons-visibility"),v.text(envira_gallery_metabox.active),o.attr("data-envira-tooltip",envira_gallery_metabox.active),s.data("status","active"),o.data("status","active")):(o.removeClass("envira-active-item").addClass("envira-draft-item"),s.removeClass("envira-active-item").addClass("envira-draft-item"),c.removeClass("dashicons-visibility").addClass("dashicons-hidden"),v.text(envira_gallery_metabox.draft),s.data("status","pending"),o.data("status","pending"),o.attr("data-envira-tooltip",envira_gallery_metabox.draft))},this),jQuery("nav.envira-tab-options input[type=checkbox]").prop("checked",!1).trigger("change"),this.trigger("loaded loaded:success"),EnviraGalleryModalWindow.close()},error:function(e){this.trigger("loaded loaded:error",e)}})},insertMediaFileLink:function(e){this.trigger("loading"),this.model.set("link",response.media_link),this.trigger("loaded loaded:success"),this.render()},insertAttachmentPageLink:function(e){this.trigger("loading"),this.model.set("link",response.media_link),this.trigger("loaded loaded:success"),this.render()}});jQuery(document).ready(function($){$("#envira-gallery-main").on("click","a.envira-gallery-images-edit",function(e){e.preventDefault(),EnviraGalleryImagesUpdate(!0),EnviraGalleryModalWindow.content(new EnviraGalleryBulkEditView({collection:EnviraGalleryImages,child_views:EnviraGalleryChildViews})),EnviraGalleryModalWindow.open()})});var EnviraGalleryImage=Backbone.Model.extend({defaults:{id:"",title:"",caption:"",alt:"",link:""}}),EnviraGalleryImages=new Backbone.Collection;if("undefined"==typeof EnviraGalleryModalWindow)var EnviraGalleryModalWindow=new wp.media.view.Modal({controller:{trigger:function(){}}});var EnviraGalleryEditView=wp.Backbone.View.extend({tagName:"div",className:"edit-attachment-frame mode-select hide-menu hide-router",template:wp.template("envira-meta-editor"),events:{"click .edit-media-header .left":"loadPreviousItem","click .edit-media-header .right":"loadNextItem","keyup input":"updateItem","keyup textarea":"updateItem","change input":"updateItem","change textarea":"updateItem","blur textarea":"updateItem","change select":"updateItem","click .actions a.envira-gallery-meta-submit":"saveItem","keyup input#link-search":"searchLinks","click div.query-results li":"insertLink","click button.media-file":"insertMediaFileLink","click button.attachment-page":"insertAttachmentPageLink"},initialize:function(e){this.on("loading",this.loading,this),this.on("loaded",this.loaded,this),this.is_loading=!1,this.collection=e.collection,this.child_views=e.child_views,this.attachment_id=e.attachment_id,this.attachment_index=0,this.search_timer="";var a=0;this.collection.each(function(e){return e.get("id")==this.attachment_id?(this.model=e,this.attachment_index=a,!1):void a++},this)},render:function(){return this.$el.html(this.template(this.model.attributes)),this.child_views.length>0&&this.child_views.forEach(function(e){var a=new e({model:this.model});this.$el.find("div.envira-addons").append(a.render().el)},this),this.$el.find("textarea[name=caption]").val(this.model.get("caption")),setTimeout(function(){quicktags({id:"caption",buttons:"strong,em,link,ul,ol,li,close"}),QTags._buttonsInit()},500),wpLink.init,0==this.attachment_index&&this.$el.find("button.left").addClass("disabled"),this.attachment_index==this.collection.length-1&&this.$el.find("button.right").addClass("disabled"),jQuery(document).trigger("enviraRenderMeta"),this},renderError:function(e){var a={};a.error=e;var t=new wp.media.view.EnviraGalleryError({model:a});return t.render().el},loading:function(){this.is_loading=!0,this.$el.find(".spinner").css("visibility","visible")},loaded:function(e){this.is_loading=!1,this.$el.find(".spinner").css("visibility","hidden"),"undefined"!=typeof e&&this.$el.find("div.media-toolbar").after(this.renderError(e))},loadPreviousItem:function(e){this.saveItem(e),this.updateItem(e),this.attachment_index--,this.model=this.collection.at(this.attachment_index),this.attachment_id=this.model.get("id"),this.render()},loadNextItem:function(e){this.saveItem(e),this.updateItem(e),this.attachment_index++,this.model=this.collection.at(this.attachment_index),this.attachment_id=this.model.get("id"),this.render()},updateItem:function(e){""!=e.target.name&&("checkbox"==e.target.type?value=e.target.checked?e.target.value:0:value=e.target.value,this.model.set(e.target.name,value))},saveItem:function(e){e.preventDefault(),this.trigger("loading"),wp.media.ajax("envira_gallery_save_meta",{context:this,data:{nonce:envira_gallery_metabox.save_nonce,post_id:envira_gallery_metabox.id,attach_id:this.model.get("id"),meta:this.model.attributes},success:function(e){this.trigger("loaded loaded:success");var a=JSON.stringify(this.model.attributes),t=jQuery("ul#envira-gallery-output li#"+this.model.get("id"));jQuery(t).attr("data-envira-gallery-image-model",a),jQuery("div.meta div.title span",t).text(this.model.get("title")),jQuery("div.meta div.title a.hint",t).attr("title",this.model.get("title")),this.model.get("title").length>20?jQuery("div.meta div.title a.hint",t).removeClass("hidden"):jQuery("div.meta div.title a.hint",t).addClass("hidden");var i=this.$el.find(".saved");i.fadeIn(),setTimeout(function(){i.fadeOut()},1500)},error:function(e){this.trigger("loaded loaded:error",e)}})},searchLinks:function(e){},insertLink:function(e){},insertMediaFileLink:function(e){this.trigger("loading"),wp.media.ajax("envira_gallery_get_attachment_links",{context:this,data:{nonce:envira_gallery_metabox.save_nonce,attachment_id:this.model.get("id")},success:function(e){this.model.set("link",e.media_link),this.trigger("loaded loaded:success"),this.render()},error:function(e){this.trigger("loaded loaded:error",e)}})},insertAttachmentPageLink:function(e){this.trigger("loading"),wp.media.ajax("envira_gallery_get_attachment_links",{context:this,data:{nonce:envira_gallery_metabox.save_nonce,attachment_id:this.model.get("id")},success:function(e){this.model.set("link",e.attachment_page),this.trigger("loaded loaded:success"),this.render()},error:function(e){this.trigger("loaded loaded:error",e)}})}}),EnviraGalleryChildViews=[];jQuery(document).ready(function($){$("a.envira-media-library").on("click",function(e){return e.preventDefault(),wp.media.frames.envira?void wp.media.frames.envira.open():(wp.media.frames.envira=wp.media({frame:"post",title:wp.media.view.l10n.insertIntoPost,button:{text:wp.media.view.l10n.insertIntoPost},multiple:!0}),wp.media.frames.envira.on("open",function(){var e=wp.media.frames.envira.state().get("selection");$("ul#envira-gallery-output li").each(function(){var a=wp.media.attachment($(this).attr("id"));void 0!=e&&e.add(a?[a]:[])})}),wp.media.frames.envira.on("insert",function(e){var a=wp.media.frames.envira.state(),t=[];e.each(function(e){var i=a.display(e).toJSON();switch(i.link){case"none":e.set("link",e.get("url"));break;case"file":e.set("link",e.get("url"));break;case"post":break;case"custom":e.set("link",i.linkUrl)}t.push(e.toJSON())},this),$(document).find(".envira-progress-adding-images").css("display","block"),$.post(envira_gallery_metabox.ajax,{action:"envira_gallery_insert_images",nonce:envira_gallery_metabox.insert_nonce,post_id:envira_gallery_metabox.id,images:JSON.stringify(t)},function(e){e&&e.success&&($("#envira-gallery-output").html(e.success),$(document).trigger("enviraInsert"),EnviraGalleryImagesUpdate(!1),$(document).find(".envira-progress-adding-images").css("display","none"))},"json")}),wp.media.frames.envira.open(),$("div.media-menu a.media-menu-item:nth-child(2)").addClass("hidden"),void $("div.media-menu a.media-menu-item:nth-child(4)").addClass("hidden"))})});var envira_manage=window.envira_manage||{};!function($,e,a,t,i){"use strict";var n="#envira-gallery-output",r=$(n+" li").length,l=!1,s=!1;e.envira_manage=t={init:function(){var e=this;e.select(),e.select_all(),e.clear_selected(),e.sortable(),e.sort_images(),e.display_toggle(),e.delete_item(),e.bulk_delete(),e.edit_meta(),e.toggle_status(),this.tooltip(),$(a).on("keyup keydown",function(e){l=e.shiftKey}),$(a).trigger("envriaAdminInit")},image_filter:function(){$("#envira-filter").on("keyup",function(e){var a=$(this),t=a.val(),i=$(".envira-item")})},toggle_status:function(){$(n).on("click.enviraStatus",".envira-item-status",function(e){e.preventDefault(),e.stopPropagation();var t=$(this),n=t.data("status"),r=t.hasClass("list-status")?t.parent().parent().parent():t.parent(),l=r.find(".envira-item-status.list-status"),s=r.find(".envira-item-status.grid-status"),o=t.data("id"),d=s.find("span.dashicons"),c=l.find("span"),v="active"===n?"pending":"active",u={url:i.ajax,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"envira_change_image_status",post_id:i.id,gallery_id:o,status:v,nonce:i.save_nonce},success:function(e){e.success&&("active"===v?(s.removeClass("envira-draft-item").addClass("envira-active-item"),l.removeClass("envira-draft-item").addClass("envira-active-item"),d.removeClass("dashicons-hidden").addClass("dashicons-visibility"),c.text(i.active),s.attr("data-envira-tooltip",i.active),l.data("status","active"),s.data("status","active")):(s.removeClass("envira-active-item").addClass("envira-draft-item"),l.removeClass("envira-active-item").addClass("envira-draft-item"),d.removeClass("dashicons-visibility").addClass("dashicons-hidden"),c.text(i.draft),l.data("status","pending"),s.data("status","pending"),s.attr("data-envira-tooltip",i.draft)),$(a).trigger("envriaChangeStatus "))},error:function(e,a,t){}};$.ajax(u)})},tooltip:function(){$("[data-envira-tooltip]").on("mouseover",function(e){e.preventDefault();var a=$(this),t=a.data("envira-tooltip")})},select_all:function(){$(a).on("change","nav.envira-tab-options input",function(e){if($(this).prop("checked")){$("li",$(n)).addClass("selected"),$("nav.envira-select-options").fadeIn();var t=$(n+" li.selected").length;$(".select-all").text(i.selected),$(".envira-count").text(t.toString()),$(".envira-clear-selected").fadeIn()}else $("li",$(n)).removeClass("selected"),$("nav.envira-select-options").fadeOut(),r=$(n+" li").length,$(".select-all").text(i.select_all),$(".envira-count").text(r.toString()),$(".envira-clear-selected").fadeOut();$(a).trigger("enviraSelectAll")})},sort_images:function(){$(a).on("change","#envira-config-image-sort, #envira-config-image-sort-dir",function(){var e=$(this),a=$("#envira-config-image-sort").val(),r=$("#envira-config-image-sort-dir").val(),l={url:i.ajax,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"envira_sort_publish",post_id:i.id,order:a,direction:r,nonce:i.save_nonce},success:function(e){e&&($(n).html(e.data),EnviraGalleryImagesUpdate(!1),"manual"===a||"0"==a?$(n).attr("data-sortable","1"):$(n).attr("data-sortable","0"),t.sortable())},error:function(e,a,t){}};$.ajax(l)})},sortable:function(){var e=$(n).attr("data-sortable");"1"===e?($(n).hasClass("ui-sortable")&&$(n).sortable("enable"),$(n).sortable({containment:n,items:"li",cursor:"move",forcePlaceholderSize:!0,placeholder:"dropzone",helper:function(e,a){a.hasClass("selected")||a.addClass("selected").siblings().removeClass("selected");var t=a.parent().children(".selected").clone();a.data("multidrag",t).siblings(".selected").remove();var i=$("<li/>");return i.append(t)},stop:function(e,a){var t=a.item.data("multidrag");a.item.after(t).remove(),$.ajax({url:i.ajax,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"envira_gallery_sort_images",order:$(n).sortable("toArray").toString(),post_id:i.id,nonce:i.sort},success:function(e){EnviraGalleryImagesUpdate(!1)},error:function(e,a,t){$(n).before('<div class="error"><p>'+a.responseText+"</p></div>")}})}})):$(n).hasClass("ui-sortable")&&$(n).sortable("disable")},select:function(){$(a).on("click","ul#envira-gallery-output li.envira-gallery-image > img, li.envira-gallery-image > div, li.envira-gallery-image > a.check",function(e){e.preventDefault();var a=$(this),t=a.parent(),o="";if(t.hasClass("selected"))t.removeClass("selected"),o=$(n+" li.selected").length,s=!1,0!==o?($(".select-all").text(i.selected),$(".envira-count").text(o.toString()),$(".envira-clear-selected").fadeIn()):(r=$(n+" li").length,$(".select-all").text(i.select_all),$(".envira-count").text(r.toString()),$(".envira-clear-selected").fadeOut());else{if(l&&s!==!1){var d=$("ul#envira-gallery-output li").index($(s)),c=$("ul#envira-gallery-output li").index($(t)),v=0;if(c>d)for(v=d;c>=v;v++)$("ul#envira-gallery-output li:eq( "+v+")").addClass("selected");else for(v=c;d>=v;v++)$("ul#envira-gallery-output li:eq( "+v+")").addClass("selected")}$(t).addClass("selected"),s=$(t),o=$(n+" li.selected").length,$(".envira-clear-selected").fadeIn(),$(".select-all").text(i.selected),$(".envira-count").text(o.toString())}$("ul#envira-gallery-output > li.selected").length>0?$("nav.envira-select-options").fadeIn():$("nav.envira-select-options").fadeOut()})},clear_selected:function(){$(".envira-clear-selected").on("click",function(e){e.preventDefault(),$(n+" li.selected").removeClass("selected"),r=$(n+" li").length,$(".select-all").text(i.select_all),$(".envira-count").text(r.toString()),$(".envira-select-all").prop("checked",!1),$("nav.envira-select-options").fadeOut(),$(this).fadeOut(),$(a).trigger("enviraClearSelected")})},display_toggle:function(){$(a).on("click","nav.envira-tab-options a",function(e){e.preventDefault();var t=$(this).closest(".envira-tab-options"),n=$(this).data("view"),r=$(this).data("view-style");$(n).hasClass(r)||($(n).removeClass("list").removeClass("grid").addClass(r),$("a",t).removeClass("selected"),$(this).addClass("selected"),$.ajax({url:i.ajax,type:"post",dataType:"json",data:{action:"envira_gallery_set_user_setting",name:"envira_gallery_image_view",value:r,nonce:i.set_user_setting_nonce},success:function(e){$(a).trigger("enviraDisplayToggle")},error:function(e,a,t){$(envira_gallery_output).before('<div class="error"><p>'+a.responseText+"</p></div>")}}))})},chosen:function(){$(".envira-chosen").each(function(){alert("b");var e=$(this).data("envira-chosen-options");$(this).chosen(e)})},update_count:function(){r=$(n+" li").length,$(".envira-count").text(r.toString()),r>0&&($("#envira-empty-itemr").fadeOut().addClass("envira-hidden"),$(".envira-item-header").removeClass("envira-hidden").fadeIn(),$(".envira-bulk-actions").fadeOut())},delete_item:function(){$(a).on("click","#envira-gallery-main .envira-gallery-remove-image",function(e){e.preventDefault();var a=confirm(i.remove);if(a){var n=$(this).parent().attr("id");$.ajax({url:i.ajax,type:"post",dataType:"json",data:{action:"envira_gallery_remove_image",attachment_id:n,post_id:i.id,nonce:i.remove_nonce},success:function(e){$("#"+n).fadeOut("normal",function(){$(this).remove(),$(".envira-gallery-load-library").attr("data-envira-gallery-offset",0).addClass("has-search").trigger("click"),EnviraGalleryImagesUpdate(!1),t.start_screen()})},error:function(e,a,t){$(envira_gallery_output).before('<div class="error"><p>'+a.responseText+"</p></div>")}})}})},bulk_delete:function(){$(a).on("click","a.envira-gallery-images-delete",function(e){e.preventDefault();var a=confirm(i.remove_multiple);if(!a)return!1;var r=[];$("ul#envira-gallery-output > li.selected").each(function(){r.push($(this).attr("id"))});var l=$(this).parent().attr("id");$.ajax({url:i.ajax,type:"post",dataType:"json",data:{action:"envira_gallery_remove_images",attachment_ids:r,post_id:i.id,nonce:i.remove_nonce},success:function(e){e&&($(n+" > li.selected").remove(),$("nav.envira-select-options").fadeOut(),$(".envira-gallery-load-library").attr("data-envira-gallery-offset",0).addClass("has-search").trigger("click"),EnviraGalleryImagesUpdate(!1),t.update_count(),t.start_screen(),$(".envira-select-all").prop("checked",!1))},error:function(e,a,t){$(envira_gallery_output).before('<div class="error"><p>'+a.responseText+"</p></div>")}})})},edit_meta:function(){$(a).on("click","#envira-gallery-main a.envira-gallery-modify-image",function(e){e.preventDefault(),EnviraGalleryImagesUpdate(!1);var t=$(this).parent().data("envira-gallery-image");EnviraGalleryModalWindow.content(new EnviraGalleryEditView({collection:EnviraGalleryImages,child_views:EnviraGalleryChildViews,attachment_id:t})),EnviraGalleryModalWindow.open(),$(a).trigger("enviraEditOpen")})},start_screen:function(){r=$(n+" li").length,0===r?($("nav.envira-select-options").fadeOut(),$(".envira-content-images").fadeOut().addClass("envira-hidden"),$("#envira-empty-gallery").removeClass("envira-hidden").fadeIn()):($("#envira-empty-gallery").fadeOut().addClass("envira-hidden"),$(".envira-content-images").removeClass("envira-hidden").fadeIn())}},$(function(){t.init()}),$(a).on("enviraGalleryType",function(){t.init()}),$(a).on("enviraInsert",function(){t.start_screen(),t.update_count()})}(jQuery,window,document,envira_manage,envira_gallery_metabox),jQuery(document).ready(function($){$("#envira-gallery-main").on("click","a.envira-gallery-images-move",function(e){e.preventDefault();var a=$(this).data("action");EnviraGalleryModalWindow.content(new EnviraGallerySelectionView({action:a,multiple:!1,sidebar_view:"envira-meta-move-media-sidebar",modal_title:envira_gallery_metabox.move_media_modal_title,insert_button_label:envira_gallery_metabox.move_media_insert_button_label,onInsert:function(){EnviraGalleryImagesUpdate(!0);var e=[];EnviraGalleryImages.forEach(function(a){e.push(a.get("id"))}),this.selection.forEach(function(t){wp.media.ajax("envira_"+a+"_move_media",{context:this,data:{nonce:envira_gallery_metabox.move_media_nonce,from_gallery_id:envira_gallery_metabox.id,to_gallery_id:t.id,image_ids:e},success:function(e){$("ul#envira-gallery-output > li.selected").remove(),$("nav.envira-select-options").fadeOut(),EnviraGalleryImagesUpdate(!1),EnviraGalleryModalWindow.close()},error:function(e){alert(e)}})})}})),EnviraGalleryModalWindow.open()})}),function($){$(function(){if("undefined"!=typeof uploader){$("input#plupload-browse-button").val(envira_gallery_metabox.uploader_files_computer);var e=$("#envira-gallery .envira-progress-bar"),a=$("#envira-gallery .envira-progress-bar div.envira-progress-bar-inner"),t=$("#envira-gallery .envira-progress-bar div.envira-progress-bar-status"),i=$("#envira-gallery-output"),n=$("#envira-gallery-upload-error"),r=0;uploader.bind("Init",function(e){$("#drag-drop-area").fadeIn(),$("a.envira-media-library.button").fadeIn()}),uploader.bind("FilesAdded",function(a,i){$(n).html(""),r=i.length,$(".uploading .current",$(t)).text("1"),$(".uploading .total",$(t)).text(r),$(".uploading",$(t)).show(),$(".done",$(t)).hide(),i[0].name.includes(".zip")&&$(".uploading").hide(),$(e).fadeIn("fast",function(){$("p.max-upload-size").css("padding-top","10px")})}),uploader.bind("UploadProgress",function(e,i){i.name.includes(".zip")?($(".uploading").hide(),$(".opening_zip",$(t)).show()):$(".uploading .current",$(t)).text(r-e.total.queued+1),$(a).css({width:e.total.percent+"%"})}),uploader.bind("FileUploaded",function(a,n,l){n.name.includes(".zip")?($(".uploading").hide(),$(".done").hide(),$(".uploading_zip").hide(),$(".envira_bar").show(),$(".envira_status").show(),$(".opening_zip").show()):$(".uploading .current",$(t)).text(r-a.total.queued+1),$.post(envira_gallery_metabox.ajax,{action:"envira_gallery_load_image",nonce:envira_gallery_metabox.load_image,id:l.response,post_id:envira_gallery_metabox.id},function(a){switch(envira_gallery_metabox.media_position){case"before":$(i).prepend(a);break;case"after":default:$(i).append(a)}$(document).trigger("enviraInsert"),EnviraGalleryImagesUpdate(!1),n.name.includes(".zip")&&($(".opening_zip").hide(),$(".uploading_zip").hide(),$(".done_zip",$(t)).show(),setTimeout(function(){$(e).fadeOut(),$(".done_zip",$(t)).hide(),$("p.max-upload-size").css("padding-top","0")},8e3))},"json")}),uploader.bind("UploadComplete",function(a,i){return i[i.length-1].name.includes(".zip")?($(".done").hide(),void $(".uploading_zip",$(t)).hide()):($(".uploading",$(t)).hide(),$(".done",$(t)).show(),void setTimeout(function(){$(e).fadeOut("fast",function(){$("p.max-upload-size").css("padding-top","0")})},1e3))}),uploader.bind("Error",function(e,a){$("#envira-gallery-upload-error").html('<div class="error fade"><p>'+a.file.name+": "+a.message+"</p></div>"),e.refresh()})}})}(jQuery);